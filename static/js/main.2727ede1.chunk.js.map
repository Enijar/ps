{"version":3,"sources":["assets/test-landscape.png","config/vars.ts","config/images.ts","components/ps/styles.ts","components/ps/types.ts","components/ps/utils.ts","config/consts.ts","components/ps/ps.tsx","index.tsx"],"names":["white","black","black300","black200","black100","encode","svg","encodeURIComponent","TRANSPARENT_BACKGROUND","vars","Tool","Wrapper","styled","div","Inner","MAX_CANVAS_WIDTH","Canvas","Sidebar","Toolbar","Flex","clamp","value","min","max","Math","getPosition","event","element","x","y","getBoundingClientRect","left","top","width","height","abs","touches","pageX","pageY","getPoints","pointGroups","pointGroupIndex","pointer","color","brushSize","size","settings","minD","p","pointGroup","undefined","points","a","b","lastPoint","length","sqrt","pow","getCursor","tool","move","brush","IS_TOUCH","window","DEFAULTS","position","startX","startY","lastX","lastY","filters","blur","saturation","hue","sepia","rotation","opacity","scale","Ps","src","React","useState","blob","setBlob","setPointGroups","setPointGroupIndex","down","setPointer","useRef","ratio","setSize","useMemo","lineCap","setRotation","setTool","setPosition","setFilters","setColor","setBrushSize","setScale","setOpacity","transform","cx","cy","s","join","download","useCallback","current","canvas","document","createElement","ctx","getContext","img","Image","onload","drawImage","toBlob","href","URL","createObjectURL","click","setAttribute","toString","base64","outerHTML","removeAttribute","reset","useEffect","toDataURL","svgElement","downType","moveType","upType","addEventListener","onPointerDown","passive","onPointerMove","onPointerUp","removeEventListener","point","preventDefault","style","cursor","ref","viewBox","xmlns","xmlnsXlink","maxWidth","maxHeight","id","stdDeviation","type","values","xlinkHref","filter","map","index","stroke","fill","d","strokeWidth","strokeLinecap","strokeLinejoin","r","strokeMiterlimit","checked","onChange","e","target","step","parseFloat","parseInt","onClick","Style","createGlobalStyle","ReactDOM","render","StrictMode","testLandscape","getElementById"],"mappings":"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","file":"static/js/main.2727ede1.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/test-landscape.3381b063.png\";","// eslint-disable-next-line import/no-anonymous-default-export\nexport default {\n  colors: {\n    white: \"#ffffff\",\n    black: \"#000000\",\n    black300: \"#333\",\n    black200: \"#222\",\n    black100: \"#1c1c1c\",\n  },\n};\n","import vars from \"./vars\";\n\nfunction encode(svg: string): string {\n  return `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;\n}\n\nexport const TRANSPARENT_BACKGROUND = encode(\n  `<svg width=\"20\" height=\"20\" viewBox=\"0 0 40 40\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m0 0h20v20h-20z\" fill=\"#d7d7d7\"/><path d=\"m20 20h20v20h-20z\" fill=\"#d7d7d7\"/><g fill=\"#fff\"><path d=\"m20 0h20v20h-20z\"/><path d=\"m0 20h20v20h-20z\"/></g></svg>`\n);\n\nexport const MOVE_ICON = encode(\n  `<svg width=\"100\" height=\"100\" viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m2674 2900-23.08 19.23v-15.38h-23.07v23.07h15.38l-19.23 23.08-19.23-23.08h15.38v-23.07h-23.07v15.38l-23.08-19.23 23.08-19.23v15.38h23.07v-23.07h-15.38l19.23-23.08 19.23 23.08h-15.38v23.07h23.07v-15.38z\" fill=\"${vars.colors.white}\" fill-rule=\"evenodd\" transform=\"translate(-2574 -2850)\"/></svg>`\n);\n\nexport const ZOOM_ICON = encode(\n  `<svg width=\"100\" height=\"98.46\" viewBox=\"0 0 100 98.46\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m2210.36 2012.7-8.65 8.64-32.57-32.57a36.468 36.468 0 1 1 8.41-8.88zm-63.33-83.71a30.56 30.56 0 1 0 30.57 30.56 30.564 30.564 0 0 0 -30.57-30.56zm0 13.75a16.653 16.653 0 0 0 -9.16 2.75v-6.94a22.909 22.909 0 0 1 32.09 21h-6.12a16.809 16.809 0 0 0 -16.81-16.81z\" fill=\"${vars.colors.white}\" fill-rule=\"evenodd\" transform=\"translate(-2110.34 -1922.88)\"/></svg>`\n);\n","import styled from \"styled-components\";\nimport vars from \"../../config/vars\";\nimport { TRANSPARENT_BACKGROUND } from \"../../config/images\";\n\nconst MOBILE_WIDTH = 700;\nconst MAX_CANVAS_WIDTH = 800;\nconst MAX_SIDEBAR_WIDTH = 200;\n\nexport const Wrapper = styled.div`\n  width: 100%;\n  min-height: 100%;\n  background-color: ${vars.colors.black100};\n  color: ${vars.colors.white};\n  user-select: none;\n  padding: 1em;\n\n  button {\n    border: none;\n    color: ${vars.colors.black300};\n    background-color: ${vars.colors.white};\n    padding: 0.25em 1em;\n  }\n`;\n\nexport const Inner = styled.div`\n  width: 100%;\n  max-width: ${MAX_CANVAS_WIDTH + MAX_SIDEBAR_WIDTH}px;\n  margin-left: auto;\n  margin-right: auto;\n`;\n\nexport const Canvas = styled.div`\n  flex: 1 0;\n  width: 100%;\n  max-width: ${MAX_CANVAS_WIDTH}px;\n\n  @media (max-width: ${MOBILE_WIDTH}px) {\n    flex: 0 1;\n  }\n\n  svg {\n    display: block;\n    background-repeat: repeat;\n    background-image: url(${TRANSPARENT_BACKGROUND});\n\n    image {\n      pointer-events: none;\n    }\n  }\n`;\n\nexport const Sidebar = styled.div`\n  align-self: flex-start;\n  padding: 1em;\n  width: 100%;\n  max-width: ${MAX_SIDEBAR_WIDTH}px;\n  background-color: ${vars.colors.black300};\n\n  @media (max-width: ${MOBILE_WIDTH}px) {\n    display: flex;\n    flex-wrap: wrap;\n    max-width: 100%;\n  }\n`;\n\nexport const Toolbar = styled.div`\n  width: 100%;\n  padding: 1em;\n  background-color: ${vars.colors.black300};\n`;\n\nexport const Flex = styled.div`\n  display: flex;\n  justify-content: center;\n  flex-wrap: wrap;\n\n  @media (max-width: ${MOBILE_WIDTH}px) {\n    flex-direction: column;\n    justify-content: flex-start;\n  }\n`;\n","export type Props = {\n  src: string;\n};\n\nexport type Point = {\n  x: number;\n  y: number;\n};\n\nexport type PointGroup = {\n  color: string;\n  size: number;\n  points: Point[];\n};\n\nexport type Pointer = {\n  down: boolean;\n  x: number;\n  y: number;\n};\n\nexport type Settings = {\n  lineCap: \"round\";\n  p: number;\n};\n\nexport type Position = {\n  x: number;\n  y: number;\n  startX: number;\n  startY: number;\n  lastX: number;\n  lastY: number;\n};\n\nexport type Filters = {\n  blur: number;\n  saturation: number;\n  hue: number;\n  sepia: boolean;\n};\n\nexport type Size = {\n  width: number;\n  height: number;\n  ratio: number;\n};\n\nexport type GetPointsProps = {\n  pointGroups: PointGroup[];\n  pointGroupIndex: number;\n  pointer: Pointer;\n  color: string;\n  brushSize?: number;\n  size: {\n    width: number;\n    height: number;\n  };\n  settings: Settings;\n};\n\nexport enum Tool {\n  move,\n  brush,\n}\n","import { GetPointsProps, Point, PointGroup, Tool } from \"./types\";\n\nexport function clamp(value: number, min: number, max: number): number {\n  return Math.min(Math.max(value, min), max);\n}\n\nexport function dist(a: Point, b: Point): number {\n  return Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));\n}\n\nexport function getPosition(\n  event: TouchEvent | PointerEvent,\n  element: SVGSVGElement | null\n): Point {\n  if (element === null) return { x: 0, y: 0 };\n  let { left, top, width, height } = element.getBoundingClientRect();\n  left = Math.abs(left);\n  top = Math.abs(top);\n  let x;\n  let y;\n  if (\"touches\" in event) {\n    x = event.touches[0]?.pageX ?? 0;\n    y = event.touches[0]?.pageY ?? 0;\n  } else {\n    x = event.pageX;\n    y = event.pageY;\n  }\n  return {\n    x: clamp(x - left, 0, width) / width,\n    y: clamp(y - top, 0, height) / height,\n  };\n}\n\nexport function getPoints({\n  pointGroups,\n  pointGroupIndex,\n  pointer,\n  color,\n  brushSize = 10,\n  size,\n  settings,\n}: GetPointsProps): PointGroup[] {\n  const minD = brushSize / Math.min(size.width, size.height) / settings.p;\n  const pointGroup = pointGroups[pointGroupIndex];\n  if (pointGroup === undefined) {\n    pointGroups[pointGroupIndex] = {\n      color,\n      size: brushSize,\n      points: [{ x: pointer.x, y: pointer.y }],\n    };\n    return [...pointGroups];\n  }\n  const lastPoint = pointGroup.points[pointGroup.points.length - 1];\n  if (lastPoint !== undefined) {\n    const d = dist(lastPoint, pointer);\n    if (d < minD) return pointGroups;\n  }\n  pointGroups[pointGroupIndex].color = color;\n  pointGroups[pointGroupIndex].points = [\n    ...pointGroups[pointGroupIndex].points,\n    { x: pointer.x, y: pointer.y },\n  ];\n  return [...pointGroups];\n}\n\nexport function getCursor(tool: Tool): string {\n  switch (tool) {\n    case Tool.move:\n      return \"move\";\n    case Tool.brush:\n      return \"none\";\n    default:\n      return \"default\";\n  }\n}\n","import vars from \"./vars\";\nimport { Tool } from \"../components/ps/types\";\n\nexport const IS_TOUCH = \"ontouchstart\" in window;\n\nexport const DEFAULTS = {\n  position: {\n    x: 0,\n    y: 0,\n    startX: 0,\n    startY: 0,\n    lastX: 0,\n    lastY: 0,\n  },\n  filters: {\n    blur: 0,\n    saturation: 1,\n    hue: 0,\n    sepia: false,\n  },\n  pointGroups: [],\n  pointGroupIndex: -1,\n  color: vars.colors.black,\n  brushSize: 10,\n  rotation: 0,\n  tool: Tool.move,\n  opacity: 1,\n  scale: 1,\n};\n","import React from \"react\";\nimport { Canvas, Flex, Inner, Sidebar, Toolbar, Wrapper } from \"./styles\";\nimport { getCursor, getPoints, getPosition } from \"./utils\";\nimport {\n  Filters,\n  Pointer,\n  PointGroup,\n  Position,\n  Props,\n  Settings,\n  Size,\n  Tool,\n} from \"./types\";\nimport { DEFAULTS, IS_TOUCH } from \"../../config/consts\";\n\nexport default function Ps({ src }: Props) {\n  const [blob, setBlob] = React.useState<string>(\"\");\n  const [pointGroups, setPointGroups] = React.useState<PointGroup[]>(DEFAULTS.pointGroups);\n  const [pointGroupIndex, setPointGroupIndex] = React.useState<number>(DEFAULTS.pointGroupIndex);\n  const [pointer, setPointer] = React.useState<Pointer>({\n    down: false,\n    x: 0,\n    y: 0,\n  });\n  const svg = React.useRef<SVGSVGElement | null>(null);\n  const [size, setSize] = React.useState<Size>({\n    width: 0,\n    height: 0,\n    ratio: 1,\n  });\n  const settings = React.useMemo<Settings>(() => {\n    return {\n      lineCap: \"round\",\n      p: 3 * size.ratio, // precision\n    };\n  }, [size]);\n  const [rotation, setRotation] = React.useState<number>(DEFAULTS.rotation);\n  const [tool, setTool] = React.useState<Tool>(Tool.move);\n  const [position, setPosition] = React.useState<Position>(DEFAULTS.position);\n  const [filters, setFilters] = React.useState<Filters>(DEFAULTS.filters);\n  const [color, setColor] = React.useState<string>(DEFAULTS.color);\n  const [brushSize, setBrushSize] = React.useState<number>(DEFAULTS.brushSize);\n  const [scale, setScale] = React.useState<number>(DEFAULTS.scale);\n  const [opacity, setOpacity] = React.useState<number>(DEFAULTS.opacity);\n  const transform = React.useMemo(() => {\n    const cx = size.width / 2;\n    const cy = size.height / 2;\n    const s = scale;\n    return [\n      `translate(${position.x * size.width} ${position.y * size.height})`,\n      `rotate(${rotation}, ${size.width / 2}, ${size.height / 2})`,\n      `matrix(${s}, 0, 0, ${s}, ${cx - s * cx}, ${cy - s * cy})`,\n    ].join(\" \");\n  }, [size, scale, position, rotation]);\n\n  const download = React.useCallback(() => {\n    const svgElement: SVGSVGElement | null = svg.current;\n    if (svgElement === null) return;\n    const canvas = document.createElement(\"canvas\");\n    const ctx: CanvasRenderingContext2D | null = canvas.getContext(\"2d\");\n    if (ctx === null) return;\n    const img = new Image();\n    img.onload = () => {\n      canvas.width = img.width;\n      canvas.height = img.height;\n      ctx.drawImage(img, 0, 0, img.width, img.height);\n      canvas.toBlob((blob) => {\n        const a = document.createElement(\"a\");\n        a.href = URL.createObjectURL(blob);\n        a.download = \"image.png\";\n        a.click();\n      }, \"image/png\");\n    };\n    if (svg.current === null) return;\n    svg.current.setAttribute(\"width\", size.width.toString());\n    svg.current.setAttribute(\"height\", size.height.toString());\n    const base64 = encodeURIComponent(svg.current.outerHTML);\n    img.src = `data:image/svg+xml;utf8,${base64}`;\n    svg.current.removeAttribute(\"width\");\n    svg.current.removeAttribute(\"height\");\n  }, [svg, size]);\n\n  const reset = React.useCallback(() => {\n    setPosition(DEFAULTS.position);\n    setFilters(DEFAULTS.filters);\n    setPointGroups(DEFAULTS.pointGroups);\n    setPointGroupIndex(DEFAULTS.pointGroupIndex);\n    setColor(DEFAULTS.color);\n    setBrushSize(DEFAULTS.brushSize);\n    setRotation(DEFAULTS.rotation);\n    setTool(DEFAULTS.tool);\n    setOpacity(DEFAULTS.opacity);\n    setScale(DEFAULTS.scale);\n  }, []);\n\n  React.useEffect(() => {\n    const img = new Image();\n    img.onload = () => {\n      const canvas = document.createElement(\"canvas\");\n      const ctx: CanvasRenderingContext2D | null = canvas.getContext(\"2d\");\n      // @todo resize image to improve performance on large images\n      if (ctx !== null) {\n        canvas.width = img.width;\n        canvas.height = img.height;\n        ctx.drawImage(img, 0, 0);\n        setBlob(canvas.toDataURL(\"image/png\"));\n      }\n      setSize({\n        width: img.width,\n        height: img.height,\n        ratio: img.width / img.height,\n      });\n    };\n    img.src = src;\n  }, [src]);\n\n  React.useEffect(() => {\n    const svgElement: SVGSVGElement | null = svg.current;\n\n    if (svgElement === null) return;\n\n    function onPointerDown(event: TouchEvent | PointerEvent) {\n      const point = getPosition(event, svgElement);\n      if (tool === Tool.brush) {\n        setPointGroupIndex((pointGroupIndex) => pointGroupIndex + 1);\n        setPointGroups((pointGroups) => [\n          ...pointGroups,\n          { color, size: brushSize, points: [point, point] },\n        ]);\n      }\n      setPosition((position) => ({\n        ...position,\n        startX: point.x,\n        startY: point.y,\n      }));\n      setPointer((pointer) => ({ ...pointer, ...point, down: true }));\n    }\n\n    function onPointerMove(event: TouchEvent | PointerEvent) {\n      event.preventDefault();\n      const point = getPosition(event, svgElement);\n      setPointer((pointer) => {\n        return { ...pointer, ...point };\n      });\n    }\n\n    function onPointerUp() {\n      setPosition((position) => ({\n        ...position,\n        lastX: position.x,\n        lastY: position.y,\n      }));\n      setPointer((pointer) => ({ ...pointer, down: false }));\n    }\n\n    const downType = IS_TOUCH ? \"touchstart\" : \"pointerdown\";\n    const moveType = IS_TOUCH ? \"touchmove\" : \"pointermove\";\n    const upType = IS_TOUCH ? \"touchend\" : \"pointerup\";\n\n    svgElement.addEventListener(downType, onPointerDown, { passive: false });\n    window.addEventListener(moveType, onPointerMove, { passive: false });\n    window.addEventListener(upType, onPointerUp, { passive: false });\n    return () => {\n      svgElement.removeEventListener(downType, onPointerDown);\n      window.removeEventListener(moveType, onPointerMove);\n      window.removeEventListener(upType, onPointerUp);\n    };\n  }, [svg, tool, size, color, brushSize]);\n\n  React.useEffect(() => {\n    if (!pointer.down || tool !== Tool.brush) return;\n    setPointGroups((pointGroups) =>\n      getPoints({\n        pointGroups,\n        pointGroupIndex,\n        pointer,\n        color,\n        size,\n        settings,\n      })\n    );\n  }, [tool, pointer, pointGroupIndex, color, size, settings]);\n\n  React.useEffect(() => {\n    if (!pointer.down || tool === Tool.brush) return;\n    setPosition((position) => ({\n      ...position,\n      x: pointer.x - position.startX + position.lastX,\n      y: pointer.y - position.startY + position.lastY,\n    }));\n  }, [pointer, tool]);\n\n  return (\n    <Wrapper>\n      <Inner>\n        <Toolbar>toolbar</Toolbar>\n\n        <Flex>\n          <Canvas style={{ cursor: getCursor(tool) }}>\n            <svg\n              ref={svg}\n              viewBox={`0 0 ${size.width} ${size.height}`}\n              xmlns=\"http://www.w3.org/2000/svg\"\n              xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n              style={{\n                maxWidth: `${size.width}px`,\n                maxHeight: `${size.height}px`,\n              }}\n            >\n              <filter id=\"filters\">\n                {/* blur */}\n                <feGaussianBlur stdDeviation={filters.blur} />\n                {/* hur */}\n                <feColorMatrix\n                  type=\"hueRotate\"\n                  values={filters.hue.toString()}\n                />\n                {/* saturation */}\n                <feColorMatrix\n                  type=\"saturate\"\n                  values={filters.saturation.toString()}\n                />\n                {/* sepia */}\n                {filters.sepia && (\n                  <feColorMatrix\n                    type=\"matrix\"\n                    values=\"0.39 0.769 0.189 0 0 0.349 0.686 0.168 0 0 0.272 0.534 0.131 0 0 0 0 0 1 0\"\n                  />\n                )}\n              </filter>\n\n              <image\n                xlinkHref={blob}\n                filter=\"url(#filters)\"\n                transform={transform}\n                opacity={opacity}\n              />\n\n              {pointGroups.map((pointGroup, index) => {\n                return (\n                  <path\n                    key={index}\n                    stroke={pointGroup.color}\n                    fill=\"none\"\n                    d={`M${pointGroup.points\n                      .map((p) =>\n                        [p.x * size.width, p.y * size.height].join(\",\")\n                      )\n                      .join(\",\")}`}\n                    strokeWidth={pointGroup.size}\n                    strokeLinecap={settings.lineCap}\n                    strokeLinejoin=\"round\"\n                  />\n                );\n              })}\n              {tool === Tool.brush && (\n                <circle\n                  cx={(pointer.x * size.width).toString()}\n                  cy={(pointer.y * size.height).toString()}\n                  r={brushSize / 2}\n                  fill={color}\n                  strokeMiterlimit=\"10\"\n                />\n              )}\n            </svg>\n          </Canvas>\n\n          <Sidebar>\n            <div>\n              <label>\n                draw:\n                <input\n                  type=\"checkbox\"\n                  checked={tool === Tool.brush}\n                  onChange={(e) =>\n                    setTool(e.target.checked ? Tool.brush : Tool.move)\n                  }\n                />\n              </label>\n            </div>\n            <div>\n              <label>\n                sepia:\n                <input\n                  type=\"checkbox\"\n                  checked={filters.sepia}\n                  onChange={(e) =>\n                    setFilters((filters) => ({\n                      ...filters,\n                      sepia: e.target.checked,\n                    }))\n                  }\n                />\n              </label>\n            </div>\n            <div>\n              <label>color({color}):</label>\n              <br />\n              <input\n                type=\"color\"\n                value={color}\n                onChange={(e) => setColor(e.target.value)}\n              />\n            </div>\n            <div>\n              <label>saturation({filters.saturation}):</label>\n              <br />\n              <input\n                type=\"range\"\n                min={0}\n                max={3}\n                step={0.01}\n                value={filters.saturation}\n                onChange={(e) =>\n                  setFilters((filters) => ({\n                    ...filters,\n                    saturation: parseFloat(e.target.value),\n                  }))\n                }\n              />\n            </div>\n            <div>\n              <label>brushSize({brushSize}px):</label>\n              <br />\n              <input\n                type=\"range\"\n                min={0}\n                max={100}\n                step={1}\n                value={brushSize}\n                onChange={(e) => setBrushSize(parseInt(e.target.value, 10))}\n              />\n            </div>\n            <div>\n              <label>rotation({rotation}&deg;):</label>\n              <br />\n              <input\n                type=\"range\"\n                min={0}\n                max={360}\n                step={1}\n                value={rotation}\n                onChange={(e) => setRotation(parseInt(e.target.value, 10))}\n              />\n            </div>\n            <div>\n              <label>blur({filters.blur}px):</label>\n              <br />\n              <input\n                type=\"range\"\n                min={0}\n                max={100}\n                step={1}\n                value={filters.blur}\n                onChange={(e) =>\n                  setFilters((filters) => ({\n                    ...filters,\n                    blur: parseInt(e.target.value, 10),\n                  }))\n                }\n              />\n            </div>\n            <div>\n              <label>hue({filters.blur}&deg;):</label>\n              <br />\n              <input\n                type=\"range\"\n                min={0}\n                max={360}\n                step={1}\n                value={filters.hue}\n                onChange={(e) =>\n                  setFilters((filters) => ({\n                    ...filters,\n                    hue: parseInt(e.target.value, 10),\n                  }))\n                }\n              />\n            </div>\n            <div>\n              <label>scale({scale}):</label>\n              <br />\n              <input\n                type=\"range\"\n                min={0.1}\n                max={2}\n                step={0.01}\n                value={scale}\n                onChange={(e) => setScale(parseFloat(e.target.value))}\n              />\n            </div>\n            <div>\n              <label>opacity({opacity}):</label>\n              <br />\n              <input\n                type=\"range\"\n                min={0}\n                max={1}\n                step={0.01}\n                value={opacity}\n                onChange={(e) => setOpacity(parseFloat(e.target.value))}\n              />\n            </div>\n            <div>\n              <button onClick={download}>download</button>\n            </div>\n            <div>\n              <button onClick={reset}>reset</button>\n            </div>\n          </Sidebar>\n        </Flex>\n      </Inner>\n    </Wrapper>\n  );\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { createGlobalStyle } from \"styled-components\";\nimport testLandscape from \"./assets/test-landscape.png\";\nimport Ps from \"./components/ps/ps\";\n\nconst Style = createGlobalStyle`\n  *, *:before, *:after {\n    box-sizing: border-box;\n    font-family: inherit;\n    font-size: inherit;\n    line-height: inherit;\n    color: inherit;\n    margin: 0;\n    padding: 0;\n  }\n\n  html, body, #root {\n    width: 100%;\n    height: 100%;\n  }\n\n  html {\n    font-size: 16px;\n    font-family: Arial, sans-serif;\n  }\n`;\n\nReactDOM.render(\n  <React.StrictMode>\n    <>\n      <Style />\n      <Ps src={testLandscape} />\n    </>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}