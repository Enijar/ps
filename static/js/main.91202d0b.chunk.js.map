{"version":3,"sources":["config/types.ts","config/vars.ts","config/consts.ts","components/ps/styles.ts","styles.ts","components/toolbar/styles.ts","config/images.ts","utils.ts","components/ps/context.tsx","components/toolbar/toolbar.tsx","components/canvas/styles.ts","components/canvas/canvas.tsx","components/sidebar/styles.ts","components/filters/styles.ts","components/filters/filters.tsx","components/layers/styles.ts","components/layers/layers.tsx","components/sidebar/sidebar.tsx","components/ps/ps.tsx","index.tsx"],"names":["FilterTypes","Tool","ToolHotKey","OrderType","white","black","black400","black300","black200","black100","DEFAULTS","position","x","y","startX","startY","lastX","lastY","scale","color","vars","brushSize","tool","move","pressedKeys","layers","selectedLayer","PsWrapper","styled","div","PsInner","MAX_CANVAS_WIDTH","Flex","props","justify","Spacer","vertical","horizontal","ToolbarWrapper","ToolButton","button","inactive","css","active","encode","svg","encodeURIComponent","TRANSPARENT_BACKGROUND","MOVE_ICON","ZOOM_ICON","BRUSH_ICON","COLOR_ICON","CROP_ICON","EYE_ICON","CROP_ICON_CURSOR","cursorWidth","clamp","value","min","max","Math","getPosition","event","element","getBoundingClientRect","left","top","width","height","abs","touches","pageX","pageY","getPoints","layer","pointer","size","settings","minD","p","pointGroup","pointGroups","pointGroupIndex","undefined","rotation","points","a","b","lastPoint","length","sqrt","pow","getCursor","brush","zoom","direction","includes","zoomOut","crop","uuid","replace","c","r","random","toString","createLayer","file","order","allowedTypes","Promise","resolve","reject","type","src","URL","createObjectURL","img","Image","onload","canvas","document","createElement","ctx","getContext","drawImage","id","name","visible","image","toDataURL","ratio","filters","opacity","blur","saturation","hue","sepia","revokeObjectURL","join","createTransform","cx","cy","s","sortLayers","asc","sort","desc","PsContext","React","createContext","PsContextProvider","children","useState","down","setPointer","setSize","setTool","setColor","setScale","setBrushSize","setLayers","setSelectedLayer","setPressedKeys","useMemo","lineCap","useRef","reset","useCallback","download","current","toBlob","blob","href","click","setAttribute","base64","outerHTML","removeAttribute","useEffect","svgElement","addEventListener","onPointerDown","passive","window","onPointerMove","onPointerUp","removeEventListener","point","map","preventDefault","getKey","key","toLowerCase","onKeyDown","onKeyUp","index","indexOf","splice","context","Provider","Toolbar","useContext","colorInput","toggleTool","currentTool","onClick","title","alt","ref","onChange","e","target","CanvasWrapper","CanvasHelper","Canvas","onDragOver","stopPropagation","onDrop","files","Array","from","dataTransfer","nextOrder","all","newLayers","concat","style","cursor","display","viewBox","xmlns","xmlnsXlink","maxWidth","maxHeight","transform","stdDeviation","values","filter","onDragStart","stroke","fill","d","strokeWidth","strokeLinecap","strokeLinejoin","strokeMiterlimit","SidebarWrapper","FiltersWrapper","Filters","currentLayer","findIndex","applyFilter","updatedLayers","checked","parseFloat","parseInt","currentTarget","step","LayersWrapper","LayerItem","selected","Layers","wrapper","renameLayer","setRenameLayer","layerName","setLayerName","selectLayer","toggleVisibility","item","onDoubleClick","onFocus","select","onBlur","onSubmit","autoFocus","Sidebar","padding","Ps","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.91202d0b.chunk.js","sourcesContent":["import React from \"react\";\n\nexport type Point = {\n  x: number;\n  y: number;\n};\n\nexport type PointGroup = {\n  color: string;\n  size: number;\n  rotation: number;\n  points: Point[];\n};\n\nexport type Pointer = {\n  down: boolean;\n  x: number;\n  y: number;\n};\n\nexport type Settings = {\n  lineCap: \"round\";\n  p: number;\n};\n\nexport type Position = {\n  x: number;\n  y: number;\n  startX: number;\n  startY: number;\n  lastX: number;\n  lastY: number;\n};\n\nexport enum FilterTypes {\n  opacity,\n  blur,\n  saturation,\n  hue,\n  sepia,\n}\n\nexport type Filters = {\n  [FilterTypes.opacity]: number;\n  [FilterTypes.blur]: number;\n  [FilterTypes.saturation]: number;\n  [FilterTypes.hue]: number;\n  [FilterTypes.sepia]: boolean;\n};\n\nexport type Size = {\n  width: number;\n  height: number;\n  ratio: number;\n};\n\nexport type GetPointsProps = {\n  layer: Layer;\n  pointer: Pointer;\n  color: string;\n  brushSize?: number;\n  size: {\n    width: number;\n    height: number;\n  };\n  settings: Settings;\n};\n\nexport enum Tool {\n  move,\n  brush,\n  zoom,\n  crop,\n}\n\nexport enum ToolHotKey {\n  move = \"v\",\n  brush = \"b\",\n  zoom = \"z\",\n  zoomOut = \"alt\",\n  crop = \"c\",\n}\n\nexport type PressedKeys = string[];\n\nexport type Layer = {\n  id: string;\n  name: string;\n  visible: boolean;\n  image: {\n    src: string;\n    width: number;\n    height: number;\n    ratio: number;\n  };\n  rotation: number;\n  position: Position;\n  filters: Filters;\n  order: number;\n  pointGroups: PointGroup[];\n  pointGroupIndex: number;\n};\n\nexport type PsContextType = {\n  layers: Layer[];\n  setLayers: React.Dispatch<React.SetStateAction<Layer[]>>;\n  selectedLayer: Layer | null;\n  setSelectedLayer: React.Dispatch<React.SetStateAction<Layer | null>>;\n  pointer: Pointer;\n  setPointer: React.Dispatch<React.SetStateAction<Pointer>>;\n  size: Size;\n  setSize: React.Dispatch<React.SetStateAction<Size>>;\n  scale: number;\n  setScale: React.Dispatch<React.SetStateAction<number>>;\n  tool: Tool;\n  setTool: React.Dispatch<React.SetStateAction<Tool>>;\n  color: string;\n  setColor: React.Dispatch<React.SetStateAction<string>>;\n  brushSize: number;\n  setBrushSize: React.Dispatch<React.SetStateAction<number>>;\n  pressedKeys: PressedKeys;\n  setPressedKeys: React.Dispatch<React.SetStateAction<PressedKeys>>;\n  settings: Settings;\n  svg: React.MutableRefObject<SVGSVGElement | null>;\n  reset: React.MouseEventHandler;\n  download: React.MouseEventHandler;\n};\n\nexport enum OrderType {\n  asc,\n  desc,\n}\n","// eslint-disable-next-line import/no-anonymous-default-export\nexport default {\n  colors: {\n    white: \"#ffffff\",\n    black: \"#000000\",\n    black400: \"#444\",\n    black300: \"#333\",\n    black200: \"#222\",\n    black100: \"#1c1c1c\",\n  },\n};\n","import vars from \"./vars\";\nimport { Tool } from \"./types\";\n\nexport const DEFAULTS = {\n  position: {\n    x: 0,\n    y: 0,\n    startX: 0,\n    startY: 0,\n    lastX: 0,\n    lastY: 0,\n  },\n  scale: 1,\n  color: vars.colors.black,\n  brushSize: 10,\n  tool: Tool.move,\n  pressedKeys: [],\n  layers: [],\n  selectedLayer: null,\n};\n\nexport const MOBILE_WIDTH = 700;\n\nexport const MAX_CANVAS_WIDTH = 800;\n\nexport const MAX_SIDEBAR_WIDTH = 200;\n\nexport const ZOOM_DELTA = 0.01;\n","import styled from \"styled-components\";\nimport vars from \"../../config/vars\";\nimport { MAX_CANVAS_WIDTH, MAX_SIDEBAR_WIDTH } from \"../../config/consts\";\n\nexport const PsWrapper = styled.div`\n  width: 100%;\n  min-height: 100%;\n  background-color: ${vars.colors.black100};\n  color: ${vars.colors.white};\n  user-select: none;\n  padding: 1em;\n`;\n\nexport const PsInner = styled.div`\n  width: 100%;\n  max-width: ${MAX_CANVAS_WIDTH + MAX_SIDEBAR_WIDTH}px;\n  margin-left: auto;\n  margin-right: auto;\n`;\n","import styled from \"styled-components\";\nimport { MOBILE_WIDTH } from \"./config/consts\";\n\ntype FlexProps = {\n  justify?:\n    | \"flex-start\"\n    | \"center\"\n    | \"flex-end\"\n    | \"space-between\"\n    | \"space-around\";\n};\n\nexport const Flex = styled.div<FlexProps>`\n  display: flex;\n  justify-content: ${(props) => props.justify ?? \"center\"};\n  flex-wrap: wrap;\n\n  @media (max-width: ${MOBILE_WIDTH}px) {\n    flex-direction: column;\n    justify-content: flex-start;\n  }\n`;\n\ntype SpacerProps = {\n  vertical?: string;\n  horizontal?: string;\n};\n\nexport const Spacer = styled.div<SpacerProps>`\n  margin-top: ${(props) => props.vertical ?? \"0px\"};\n  margin-right: ${(props) => props.horizontal ?? \"0px\"};\n`;\n","import styled, { css } from \"styled-components\";\nimport vars from \"../../config/vars\";\n\nconst TOOL_BUTTON_PADDING = \"0.5em\";\n\nexport const ToolbarWrapper = styled.div`\n  background-color: ${vars.colors.black300};\n  padding: 0.25em;\n  display: flex;\n  flex-direction: column;\n`;\n\ntype ToolButtonProps = {\n  active?: boolean;\n  inactive?: boolean;\n};\n\nexport const ToolButton = styled.button<ToolButtonProps>`\n  border: none;\n  background-color: transparent;\n  cursor: pointer;\n  outline: none;\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: ${TOOL_BUTTON_PADDING};\n  margin-bottom: 0.25em;\n\n  &:last-child {\n    margin-bottom: 0;\n  }\n\n  &:hover {\n    background-color: ${vars.colors.black100};\n\n    ${(props) => {\n      if (!props.inactive) return;\n      return css`\n        background-color: transparent;\n      `;\n    }}\n  }\n\n  ${(props) => {\n    if (!props.active) return;\n    return css`\n      background-color: ${vars.colors.black100};\n    `;\n  }}\n\n  img {\n    width: 1.5em;\n    align-self: center;\n    flex-shrink: 0;\n  }\n\n  input {\n    position: absolute;\n    cursor: pointer;\n    opacity: 0;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    z-index: 1;\n  }\n`;\n","import vars from \"./vars\";\n\nfunction encode(svg: string): string {\n  return `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;\n}\n\nexport const TRANSPARENT_BACKGROUND = encode(\n  `<svg width=\"20\" height=\"20\" viewBox=\"0 0 40 40\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m0 0h20v20h-20z\" fill=\"#d7d7d7\"/><path d=\"m20 20h20v20h-20z\" fill=\"#d7d7d7\"/><g fill=\"${vars.colors.white}\"><path d=\"m20 0h20v20h-20z\"/><path d=\"m0 20h20v20h-20z\"/></g></svg>`\n);\n\nexport const MOVE_ICON = encode(\n  `<svg width=\"100\" height=\"100\" viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m2674 2900-23.08 19.23v-15.38h-23.07v23.07h15.38l-19.23 23.08-19.23-23.08h15.38v-23.07h-23.07v15.38l-23.08-19.23 23.08-19.23v15.38h23.07v-23.07h-15.38l19.23-23.08 19.23 23.08h-15.38v23.07h23.07v-15.38z\" fill=\"${vars.colors.white}\" fill-rule=\"evenodd\" transform=\"translate(-2574 -2850)\"/></svg>`\n);\n\nexport const ZOOM_ICON = encode(\n  `<svg width=\"100\" height=\"98.46\" viewBox=\"0 0 100 98.46\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m2210.36 2012.7-8.65 8.64-32.57-32.57a36.468 36.468 0 1 1 8.41-8.88zm-63.33-83.71a30.56 30.56 0 1 0 30.57 30.56 30.564 30.564 0 0 0 -30.57-30.56zm0 13.75a16.653 16.653 0 0 0 -9.16 2.75v-6.94a22.909 22.909 0 0 1 32.09 21h-6.12a16.809 16.809 0 0 0 -16.81-16.81z\" fill=\"${vars.colors.white}\" fill-rule=\"evenodd\" transform=\"translate(-2110.34 -1922.88)\"/></svg>`\n);\n\nexport const BRUSH_ICON = encode(\n  `<svg width=\"99.93\" height=\"102.85\" viewBox=\"0 0 99.93 102.85\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m2628.24 1289.83s-2.56-8.1-13.65-10.23c10.6-12.15 50.94-60.57 58-54.58 8.92 7.55-44.35 64.81-44.35 64.81zm-3.41 10.24s1.1 27.29-51.18 27.29c0 0 10.24-7.01 10.24-13.65 0-6.82 6.65-30.7 23.88-30.7 17.06 0 17.06 17.06 17.06 17.06z\" fill=\"${vars.colors.white}\" fill-rule=\"evenodd\" transform=\"translate(-2573.66 -1224.53)\"/></svg>`\n);\n\nexport const COLOR_ICON = encode(\n  `<svg width=\"100\" height=\"100\" viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m2674 2022h-70v-30h-30v-70h70v30h30zm-10-60h-20v30h-30v20h50z\" fill=\"${vars.colors.white}\" fill-rule=\"evenodd\" transform=\"translate(-2574 -1922)\"/></svg>`\n);\n\nexport const CROP_ICON = encode(\n  `<svg width=\"100\" height=\"89.188\" viewBox=\"0 0 100 89.188\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m1278.45 838.175h-12.17v-8.108h12.17a4.054 4.054 0 0 1 0 8.108zm-21.63 18.919a4.05 4.05 0 0 1 -4.05-4.054v-60.81h-31.08a4.055 4.055 0 1 1 0-8.109h39.19v68.919a4.058 4.058 0 0 1 -4.06 4.054zm-13.51-27.027a4.054 4.054 0 0 1 0 8.108h-39.19v-66.216a4.055 4.055 0 0 1 8.11 0v58.108zm-60.81-41.891a4.05 4.05 0 0 1 4.05-4.055h12.17v8.109h-12.17a4.051 4.051 0 0 1 -4.05-4.054z\" fill=\"${vars.colors.white}\" fill-rule=\"evenodd\" transform=\"translate(-1182.5 -767.906)\"/></svg>`\n);\n\nexport const EYE_ICON = encode(\n  `<svg width=\"99.3\" height=\"66.2\" viewBox=\"0 0 99.3 66.2\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"${vars.colors.white}\"><path d=\"m49.7 0c-32.7 0-49.7 33.1-49.7 33.1s18.5 33.1 49.7 33.1c33.1 0 49.7-33.1 49.7-33.1s-17.9-33.1-49.7-33.1zm0 53.8c-13.7 0-24.8-8.6-24.8-20.7 0-16.4 11.1-24.8 24.8-24.8s24.8 8.2 24.8 24.8c0 12.3-11.1 20.7-24.8 20.7z\"/><path d=\"m62.1 29c-4.6 0-8.3-3.7-8.3-8.3 0-1.4.4-2.7 1-3.8-1-.2-2-.3-3-.3-8 0-14.5 6.5-14.5 14.5s6.5 14.5 14.5 14.5 14.5-6.5 14.5-14.5c0-1-.1-2.1-.3-3-1.3.5-2.6.9-3.9.9z\"/></g></svg>`\n);\n\nconst cursorRatio = 89.188 / 100;\nconst cursorScale = 0.5;\nconst cursorWidth = 100 * cursorScale;\nconst cursorHeight = cursorWidth * cursorScale * cursorRatio;\nexport const CROP_ICON_CURSOR = encode(\n  `<svg width=\"${cursorWidth}\" height=\"${cursorHeight}\" viewBox=\"0 0 100 89.188\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m1278.45 838.175h-12.17v-8.108h12.17a4.054 4.054 0 0 1 0 8.108zm-21.63 18.919a4.05 4.05 0 0 1 -4.05-4.054v-60.81h-31.08a4.055 4.055 0 1 1 0-8.109h39.19v68.919a4.058 4.058 0 0 1 -4.06 4.054zm-13.51-27.027a4.054 4.054 0 0 1 0 8.108h-39.19v-66.216a4.055 4.055 0 0 1 8.11 0v58.108zm-60.81-41.891a4.05 4.05 0 0 1 4.05-4.055h12.17v8.109h-12.17a4.051 4.051 0 0 1 -4.05-4.054z\" fill=\"${vars.colors.white}\" fill-rule=\"evenodd\" transform=\"translate(-1182.5 -767.906)\"/></svg>`\n);\n","import {\n  GetPointsProps,\n  Layer,\n  OrderType,\n  Point,\n  PointGroup,\n  PressedKeys,\n  Size,\n  Tool,\n  ToolHotKey,\n  FilterTypes,\n} from \"./config/types\";\nimport { CROP_ICON_CURSOR } from \"./config/images\";\nimport { DEFAULTS } from \"./config/consts\";\n\nexport function clamp(value: number, min: number, max: number): number {\n  return Math.min(Math.max(value, min), max);\n}\n\nexport function dist(a: Point, b: Point): number {\n  return Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));\n}\n\nexport function getPosition(\n  event: TouchEvent | PointerEvent,\n  element: SVGSVGElement | null\n): Point {\n  if (element === null) return { x: 0, y: 0 };\n  let { left, top, width, height } = element.getBoundingClientRect();\n  left = Math.abs(left);\n  top = Math.abs(top);\n  let x;\n  let y;\n  if (\"touches\" in event) {\n    x = event.touches[0]?.pageX ?? 0;\n    y = event.touches[0]?.pageY ?? 0;\n  } else {\n    x = event.pageX;\n    y = event.pageY;\n  }\n  return {\n    x: clamp(x - left, 0, width) / width,\n    y: clamp(y - top, 0, height) / height,\n  };\n}\n\nexport function getPoints({\n  layer,\n  pointer,\n  color,\n  brushSize = 10,\n  size,\n  settings,\n}: GetPointsProps): PointGroup[] {\n  const minD = brushSize / Math.min(size.width, size.height) / settings.p;\n  const pointGroup = layer.pointGroups[layer.pointGroupIndex];\n  if (pointGroup === undefined) {\n    layer.pointGroups[layer.pointGroupIndex] = {\n      color,\n      size: brushSize,\n      rotation: 0,\n      points: [{ x: pointer.x, y: pointer.y }],\n    };\n    return [...layer.pointGroups];\n  }\n  const lastPoint = pointGroup.points[pointGroup.points.length - 1];\n  if (lastPoint !== undefined) {\n    const d = dist(lastPoint, pointer);\n    if (d < minD) return layer.pointGroups;\n  }\n  layer.pointGroups[layer.pointGroupIndex].color = color;\n  layer.pointGroups[layer.pointGroupIndex].points = [\n    ...layer.pointGroups[layer.pointGroupIndex].points,\n    { x: pointer.x - layer.position.x, y: pointer.y - layer.position.y },\n  ];\n  return [...layer.pointGroups];\n}\n\nexport function getCursor(tool: Tool, pressedKeys: PressedKeys = []): string {\n  switch (tool) {\n    case Tool.move:\n      return \"move\";\n    case Tool.brush:\n      return \"none\";\n    case Tool.zoom:\n      const direction = pressedKeys.includes(ToolHotKey.zoomOut) ? \"out\" : \"in\";\n      return `zoom-${direction}`;\n    case Tool.crop:\n      return `url(\"${CROP_ICON_CURSOR}\") 17 0, default`;\n    default:\n      return \"default\";\n  }\n}\n\nexport function uuid(): string {\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\n    // eslint-disable-next-line no-mixed-operators\n    const r = (Math.random() * 16) | 0,\n      v = c === \"x\" ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport function createLayer(file: File, order = 0): Promise<Layer> {\n  const allowedTypes = [\"image/png\", \"image/jpg\", \"image/jpeg\"];\n  return new Promise((resolve, reject) => {\n    if (!allowedTypes.includes(file.type)) {\n      reject(`Invalid image file, must be one of: ${allowedTypes.join(\" \")}`);\n      return;\n    }\n    const src = URL.createObjectURL(file);\n    const img = new Image();\n    img.onload = () => {\n      const canvas = document.createElement(\"canvas\");\n      const ctx = canvas.getContext(\"2d\");\n      if (ctx === null) {\n        reject(\"Failed to load image\");\n        return;\n      }\n      canvas.width = img.width;\n      canvas.height = img.height;\n      // @todo scale down large images to improve performance\n      ctx.drawImage(img, 0, 0);\n      resolve({\n        id: uuid(),\n        name: `Layer ${order + 1}`,\n        visible: true,\n        image: {\n          src: canvas.toDataURL(\"image/png\"),\n          width: img.width,\n          height: img.height,\n          ratio: img.width / img.height,\n        },\n        rotation: 0,\n        position: DEFAULTS.position,\n        filters: {\n          [FilterTypes.opacity]: 1,\n          [FilterTypes.blur]: 0,\n          [FilterTypes.saturation]: 1,\n          [FilterTypes.hue]: 0,\n          [FilterTypes.sepia]: false,\n        },\n        pointGroups: [],\n        pointGroupIndex: -1,\n        order,\n      });\n      URL.revokeObjectURL(src);\n    };\n    img.src = src;\n  });\n}\n\nexport function createTransform(\n  size: Size,\n  layer: Layer,\n  rotation: number = 0\n): string {\n  const { position } = layer;\n  const cx = size.width / 2;\n  const cy = size.height / 2;\n  const s = 1;\n  return [\n    `translate(${position.x * size.width} ${position.y * size.height})`,\n    `rotate(${rotation}, ${size.width / 2}, ${size.height / 2})`,\n    `matrix(${s}, 0, 0, ${s}, ${cx - s * cx}, ${cy - s * cy})`,\n  ].join(\" \");\n}\n\nexport function sortLayers(\n  layers: Layer[],\n  order: OrderType = OrderType.asc\n): Layer[] {\n  return layers.sort((a, b) => {\n    if (order === OrderType.desc) return b.order - a.order;\n    if (order === OrderType.asc) return a.order - b.order;\n    return 0;\n  });\n}\n","import React from \"react\";\nimport {\n  Layer,\n  Pointer,\n  PressedKeys,\n  PsContextType,\n  Settings,\n  Size,\n  Tool,\n  ToolHotKey,\n} from \"../../config/types\";\nimport { DEFAULTS, ZOOM_DELTA } from \"../../config/consts\";\nimport { getPoints, getPosition } from \"../../utils\";\n\ntype Props = {\n  children: any;\n};\n\nexport const PsContext = React.createContext({});\n\nexport default function PsContextProvider({ children }: Props) {\n  const [pointer, setPointer] = React.useState<Pointer>({\n    down: false,\n    x: 0,\n    y: 0,\n  });\n  const [size, setSize] = React.useState<Size>({\n    width: 0,\n    height: 0,\n    ratio: 1,\n  });\n  const [tool, setTool] = React.useState<Tool>(Tool.move);\n  const [color, setColor] = React.useState<string>(DEFAULTS.color);\n  const [scale, setScale] = React.useState<number>(DEFAULTS.scale);\n  const [brushSize, setBrushSize] = React.useState<number>(DEFAULTS.brushSize);\n  const [layers, setLayers] = React.useState<Layer[]>(DEFAULTS.layers);\n  const [selectedLayer, setSelectedLayer] = React.useState<Layer | null>(\n    DEFAULTS.selectedLayer\n  );\n  const [pressedKeys, setPressedKeys] = React.useState<PressedKeys>(\n    DEFAULTS.pressedKeys\n  );\n  const settings = React.useMemo<Settings>(() => {\n    return {\n      lineCap: \"round\",\n      p: 3 * size.ratio, // precision\n    };\n  }, [size]);\n  const svg = React.useRef<SVGSVGElement | null>(null);\n\n  const reset = React.useCallback(() => {\n    setScale(DEFAULTS.scale);\n    setColor(DEFAULTS.color);\n    setBrushSize(DEFAULTS.brushSize);\n    setTool(DEFAULTS.tool);\n    setPressedKeys(DEFAULTS.pressedKeys);\n    setLayers(DEFAULTS.layers);\n    setSelectedLayer(DEFAULTS.selectedLayer);\n  }, []);\n\n  const download = React.useCallback(() => {\n    const svgElement: SVGSVGElement | null = svg.current;\n    if (svgElement === null) return;\n    const canvas = document.createElement(\"canvas\");\n    const ctx: CanvasRenderingContext2D | null = canvas.getContext(\"2d\");\n    if (ctx === null) return;\n    const img = new Image();\n    img.onload = () => {\n      canvas.width = img.width;\n      canvas.height = img.height;\n      ctx.drawImage(img, 0, 0, img.width, img.height);\n      canvas.toBlob((blob) => {\n        const a = document.createElement(\"a\");\n        a.href = URL.createObjectURL(blob);\n        a.download = \"image.png\";\n        a.click();\n      }, \"image/png\");\n    };\n    if (svg.current === null) return;\n    svg.current.setAttribute(\"width\", size.width.toString());\n    svg.current.setAttribute(\"height\", size.height.toString());\n    const base64 = encodeURIComponent(svg.current.outerHTML);\n    img.src = `data:image/svg+xml;utf8,${base64}`;\n    svg.current.removeAttribute(\"width\");\n    svg.current.removeAttribute(\"height\");\n  }, [size, svg]);\n\n  React.useEffect(() => {\n    const svgElement: SVGSVGElement | null = svg.current;\n\n    if (svgElement === null) return;\n\n    function onPointerDown(event: TouchEvent | PointerEvent) {\n      const point = getPosition(event, svgElement);\n      if (selectedLayer !== null) {\n        setLayers((layers) => {\n          return layers.map((layer) => {\n            if (!layer.visible) return layer;\n            if (layer.id === selectedLayer.id) {\n              if (tool === Tool.brush) {\n                const x = point.x - layer.position.x;\n                const y = point.y - layer.position.y;\n                layer.pointGroupIndex = layer.pointGroupIndex + 1;\n                layer.pointGroups = [\n                  ...layer.pointGroups,\n                  {\n                    color,\n                    size: brushSize,\n                    rotation: 0,\n                    points: [\n                      { x, y },\n                      { x, y },\n                    ],\n                  },\n                ];\n              }\n              layer.position = {\n                ...layer.position,\n                startX: point.x,\n                startY: point.y,\n              };\n            }\n            return { ...layer };\n          });\n        });\n      }\n      setPointer((pointer) => ({ ...pointer, ...point, down: true }));\n    }\n\n    function onPointerMove(event: TouchEvent | PointerEvent) {\n      event.preventDefault();\n      const point = getPosition(event, svgElement);\n      setPointer((pointer) => ({ ...pointer, ...point }));\n    }\n\n    function onPointerUp() {\n      if (selectedLayer !== null) {\n        setLayers((layers) => {\n          return layers.map((layer) => {\n            if (!layer.visible) return layer;\n            if (layer.id === selectedLayer.id) {\n              layer.position = {\n                ...layer.position,\n                lastX: layer.position.x,\n                lastY: layer.position.y,\n              };\n            }\n            return layer;\n          });\n        });\n      }\n      setPointer((pointer) => ({ ...pointer, down: false }));\n    }\n\n    svgElement.addEventListener(\"pointerdown\", onPointerDown, {\n      passive: true,\n    });\n    window.addEventListener(\"pointermove\", onPointerMove, { passive: false });\n    window.addEventListener(\"pointerup\", onPointerUp, { passive: false });\n    svgElement.addEventListener(\"touchstart\", onPointerDown, {\n      passive: false,\n    });\n    window.addEventListener(\"touchmove\", onPointerMove, { passive: false });\n    window.addEventListener(\"touchend\", onPointerUp, { passive: false });\n    return () => {\n      svgElement.removeEventListener(\"pointerdown\", onPointerDown);\n      window.removeEventListener(\"pointermove\", onPointerMove);\n      window.removeEventListener(\"pointerup\", onPointerUp);\n      svgElement.removeEventListener(\"touchstart\", onPointerDown);\n      window.removeEventListener(\"touchmove\", onPointerMove);\n      window.removeEventListener(\"touchend\", onPointerUp);\n    };\n  }, [\n    svg,\n    tool,\n    size,\n    color,\n    brushSize,\n    setPointer,\n    selectedLayer,\n    setLayers,\n    pointer,\n  ]);\n\n  React.useEffect(() => {\n    if (!pointer.down || tool !== Tool.brush) return;\n    setLayers((layers) => {\n      return layers.map((layer) => {\n        if (selectedLayer?.id === layer.id) {\n          layer.pointGroups = getPoints({\n            layer,\n            pointer,\n            color,\n            size,\n            settings,\n          });\n        }\n        return layer;\n      });\n    });\n  }, [tool, pointer, color, size, settings, selectedLayer]);\n\n  React.useEffect(() => {\n    if (!pointer.down || tool !== Tool.move || selectedLayer === null) return;\n    setLayers((layers) => {\n      return layers.map((layer) => {\n        if (!layer.visible) return layer;\n        if (layer.id === selectedLayer.id) {\n          layer.position = {\n            ...layer.position,\n            x: pointer.x - layer.position.startX + layer.position.lastX,\n            y: pointer.y - layer.position.startY + layer.position.lastY,\n          };\n        }\n        return layer;\n      });\n    });\n  }, [pointer, tool, selectedLayer]);\n\n  React.useEffect(() => {\n    if (pressedKeys.includes(ToolHotKey.move)) {\n      setTool(Tool.move);\n    }\n    if (pressedKeys.includes(ToolHotKey.brush)) {\n      setTool(Tool.brush);\n    }\n    if (pressedKeys.includes(ToolHotKey.zoom)) {\n      setTool(Tool.zoom);\n    }\n    if (pressedKeys.includes(ToolHotKey.crop)) {\n      setTool(Tool.crop);\n    }\n  }, [pressedKeys]);\n\n  React.useEffect(() => {\n    if (pointer.down && tool === Tool.zoom) {\n      const direction = pressedKeys.includes(ToolHotKey.zoomOut) ? -1 : 1;\n      setScale((scale) => scale + ZOOM_DELTA * direction);\n    }\n  }, [pressedKeys, tool, pointer.down]);\n\n  React.useEffect(() => {\n    function getKey(event: KeyboardEvent): string {\n      return event.key.toLowerCase();\n    }\n\n    function onKeyDown(event: KeyboardEvent) {\n      const key = getKey(event);\n      setPressedKeys((pressedKeys) => {\n        if (pressedKeys.includes(key)) return pressedKeys;\n        return [...pressedKeys, key];\n      });\n    }\n\n    function onKeyUp(event: KeyboardEvent) {\n      const key = getKey(event);\n      setPressedKeys((pressedKeys) => {\n        const index = pressedKeys.indexOf(key);\n        if (index === -1) return pressedKeys;\n        pressedKeys.splice(index, 1);\n        return [...pressedKeys];\n      });\n    }\n\n    window.addEventListener(\"keydown\", onKeyDown);\n    window.addEventListener(\"keyup\", onKeyUp);\n    return () => {\n      window.removeEventListener(\"keydown\", onKeyDown);\n      window.removeEventListener(\"keyup\", onKeyUp);\n    };\n  }, []);\n\n  const context: PsContextType = {\n    layers,\n    setLayers,\n    selectedLayer,\n    setSelectedLayer,\n    pointer,\n    setPointer,\n    size,\n    setSize,\n    tool,\n    setTool,\n    color,\n    setColor,\n    brushSize,\n    setBrushSize,\n    pressedKeys,\n    setPressedKeys,\n    settings,\n    svg,\n    reset,\n    download,\n    scale,\n    setScale,\n  };\n\n  return <PsContext.Provider value={context}>{children}</PsContext.Provider>;\n}\n","import React from \"react\";\nimport { ToolbarWrapper, ToolButton } from \"./styles\";\nimport {\n  BRUSH_ICON,\n  COLOR_ICON,\n  CROP_ICON,\n  MOVE_ICON,\n  ZOOM_ICON,\n} from \"../../config/images\";\nimport { PsContextType, Tool, ToolHotKey } from \"../../config/types\";\nimport { PsContext } from \"../ps/context\";\nimport { DEFAULTS } from \"../../config/consts\";\n\nexport default function Toolbar() {\n  const { tool, setTool, setColor } = React.useContext(\n    PsContext\n  ) as PsContextType;\n  const colorInput = React.useRef<HTMLInputElement | null>(null);\n\n  const toggleTool = React.useCallback(\n    (tool: Tool) => {\n      return () => {\n        setTool((currentTool) => {\n          if (currentTool === tool) return DEFAULTS.tool;\n          return tool;\n        });\n      };\n    },\n    [setTool]\n  );\n\n  return (\n    <ToolbarWrapper>\n      <ToolButton\n        onClick={toggleTool(Tool.move)}\n        active={tool === Tool.move}\n        title={`Move (${ToolHotKey.move})`}\n      >\n        <img src={MOVE_ICON} alt=\"\" />\n      </ToolButton>\n      <ToolButton\n        onClick={toggleTool(Tool.zoom)}\n        active={tool === Tool.zoom}\n        title={`Zoom (${ToolHotKey.zoom})`}\n      >\n        <img src={ZOOM_ICON} alt=\"\" />\n      </ToolButton>\n      <ToolButton\n        onClick={toggleTool(Tool.brush)}\n        active={tool === Tool.brush}\n        title={`Brush (${ToolHotKey.brush})`}\n      >\n        <img src={BRUSH_ICON} alt=\"\" />\n      </ToolButton>\n      <ToolButton inactive title=\"Color\">\n        <img src={COLOR_ICON} alt=\"\" />\n        <input\n          ref={colorInput}\n          type=\"color\"\n          onChange={(e) => setColor(e.target.value)}\n        />\n      </ToolButton>\n      <ToolButton\n        onClick={toggleTool(Tool.crop)}\n        active={tool === Tool.crop}\n        title={`Crop (${ToolHotKey.crop})`}\n      >\n        <img src={CROP_ICON} alt=\"\" />\n      </ToolButton>\n    </ToolbarWrapper>\n  );\n}\n","import styled from \"styled-components\";\nimport { MAX_CANVAS_WIDTH, MOBILE_WIDTH } from \"../../config/consts\";\nimport { TRANSPARENT_BACKGROUND } from \"../../config/images\";\nimport vars from \"../../config/vars\";\n\nexport const CanvasWrapper = styled.div`\n  flex: 1 0;\n  width: 100%;\n  max-width: ${MAX_CANVAS_WIDTH}px;\n  background-color: ${vars.colors.black400};\n\n  @media (max-width: ${MOBILE_WIDTH}px) {\n    flex: 0 1;\n  }\n\n  svg {\n    margin: auto;\n    display: block;\n    background-repeat: repeat;\n    background-image: url(${TRANSPARENT_BACKGROUND});\n  }\n`;\n\nexport const CanvasHelper = styled.div`\n  pointer-events: none;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n`;\n","import React from \"react\";\nimport { CanvasHelper, CanvasWrapper } from \"./styles\";\nimport { Layer, PsContextType, Tool, FilterTypes } from \"../../config/types\";\nimport { PsContext } from \"../ps/context\";\nimport {\n  createLayer,\n  createTransform,\n  getCursor,\n  sortLayers,\n} from \"../../utils\";\n\nexport default function Canvas() {\n  const {\n    size,\n    setSize,\n    setSelectedLayer,\n    layers,\n    setLayers,\n    settings,\n    tool,\n    pointer,\n    brushSize,\n    color,\n    svg,\n    pressedKeys,\n    scale,\n  } = React.useContext(PsContext) as PsContextType;\n\n  const onDragOver = React.useCallback((event: React.DragEvent<any>) => {\n    event.stopPropagation();\n    event.preventDefault();\n  }, []);\n\n  const onDrop = React.useCallback(\n    async (event: React.DragEvent<any>) => {\n      event.stopPropagation();\n      event.preventDefault();\n      const files = Array.from(event.dataTransfer.files);\n      const nextOrder = Math.max(\n        Math.max(...layers.map((layer) => layer.order)) + 1,\n        0\n      );\n      // @todo handle errors\n      const newLayers: Layer[] = await Promise.all(\n        files.map((file, index) => createLayer(file, nextOrder + index))\n      );\n      if (layers.length === 0) {\n        setSize({\n          width: newLayers[0].image.width,\n          height: newLayers[0].image.height,\n          ratio: newLayers[0].image.ratio,\n        });\n      }\n      setLayers(layers.concat(newLayers));\n      setSelectedLayer(newLayers[newLayers.length - 1]);\n    },\n    [layers, setSize, setLayers, setSelectedLayer]\n  );\n\n  return (\n    <CanvasWrapper\n      style={{ cursor: getCursor(tool, pressedKeys) }}\n      onDragOver={onDragOver}\n      onDrop={onDrop}\n    >\n      <CanvasHelper style={{ display: layers.length > 0 ? \"none\" : undefined }}>\n        Drop image(s) here to get started!\n      </CanvasHelper>\n      <svg\n        ref={svg}\n        viewBox={`0 0 ${size.width} ${size.height}`}\n        xmlns=\"http://www.w3.org/2000/svg\"\n        xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n        style={{\n          maxWidth: `${size.width}px`,\n          maxHeight: `${size.height}px`,\n          display: layers.length === 0 ? \"none\" : undefined,\n        }}\n      >\n        <g style={{ transform: `scale(${scale})` }}>\n          {sortLayers(layers).map((layer, index) => {\n            if (!layer.visible) return null;\n            return (\n              <g key={layer.id}>\n                <filter key={layer.id} id={`filters-${index}`}>\n                  {/* blur */}\n                  <feGaussianBlur\n                    stdDeviation={layer.filters[FilterTypes.blur]}\n                  />\n                  {/* hue */}\n                  <feColorMatrix\n                    type=\"hueRotate\"\n                    values={layer.filters[FilterTypes.hue].toString()}\n                  />\n                  {/* saturation */}\n                  <feColorMatrix\n                    type=\"saturate\"\n                    values={layer.filters[FilterTypes.saturation].toString()}\n                  />\n                  {/* sepia */}\n                  {layer.filters[FilterTypes.sepia] && (\n                    <feColorMatrix\n                      type=\"matrix\"\n                      values=\"0.39 0.769 0.189 0 0 0.349 0.686 0.168 0 0 0.272 0.534 0.131 0 0 0 0 0 1 0\"\n                    />\n                  )}\n                </filter>\n\n                <g\n                  filter={`url(#filters-${index})`}\n                  opacity={layer.filters[FilterTypes.opacity]}\n                >\n                  <image\n                    onDragStart={(event) => event.preventDefault()}\n                    href={layer.image.src}\n                    transform={createTransform(size, layer, layer.rotation)}\n                  />\n\n                  {layer.pointGroups.map((pointGroup, index) => {\n                    return (\n                      <path\n                        key={index}\n                        stroke={pointGroup.color}\n                        fill=\"none\"\n                        d={`M${pointGroup.points\n                          .map((p) =>\n                            [p.x * size.width, p.y * size.height].join(\",\")\n                          )\n                          .join(\",\")}`}\n                        strokeWidth={pointGroup.size}\n                        strokeLinecap={settings.lineCap}\n                        strokeLinejoin=\"round\"\n                        transform={createTransform(size, layer, pointGroup.rotation)}\n                      />\n                    );\n                  })}\n                </g>\n              </g>\n            );\n          })}\n        </g>\n        {tool === Tool.brush && (\n          <circle\n            cx={(pointer.x * size.width).toString()}\n            cy={(pointer.y * size.height).toString()}\n            r={brushSize / 2}\n            fill={color}\n            strokeMiterlimit=\"10\"\n          />\n        )}\n      </svg>\n    </CanvasWrapper>\n  );\n}\n","import styled from \"styled-components\";\nimport vars from \"../../config/vars\";\nimport { MAX_SIDEBAR_WIDTH, MOBILE_WIDTH } from \"../../config/consts\";\n\nexport const SidebarWrapper = styled.div`\n  align-self: flex-start;\n  width: 100%;\n  max-width: ${MAX_SIDEBAR_WIDTH}px;\n  background-color: ${vars.colors.black300};\n\n  @media (max-width: ${MOBILE_WIDTH}px) {\n    display: flex;\n    flex-wrap: wrap;\n    max-width: 100%;\n  }\n`;\n","import styled from \"styled-components\";\n\nexport const FiltersWrapper = styled.div`\n  //\n`;\n","import React from \"react\";\nimport { FiltersWrapper } from \"./styles\";\nimport { FilterTypes, Layer, PsContextType } from \"../../config/types\";\nimport { PsContext } from \"../ps/context\";\n\nexport default function Filters() {\n  const {\n    brushSize,\n    setBrushSize,\n    selectedLayer,\n    layers,\n    setLayers,\n  } = React.useContext(PsContext) as PsContextType;\n  const currentLayer = React.useMemo<Layer | null>(() => {\n    const index = layers.findIndex((layer) => layer.id === selectedLayer?.id);\n    if (index === -1) return null;\n    return layers[index];\n  }, [selectedLayer, layers]);\n\n  const applyFilter = React.useCallback(\n    (type: FilterTypes) => {\n      return (event: React.ChangeEvent<HTMLInputElement>) => {\n        const updatedLayers = [...layers];\n        const index = updatedLayers.findIndex(\n          (layer) => layer.id === selectedLayer?.id\n        );\n        if (index === -1) return;\n        switch (type) {\n          case FilterTypes.sepia:\n            updatedLayers[index].filters = {\n              ...updatedLayers[index].filters,\n              [FilterTypes.sepia]: event.target.checked,\n            };\n            break;\n          case FilterTypes.saturation:\n            updatedLayers[index].filters = {\n              ...updatedLayers[index].filters,\n              [FilterTypes.saturation]: parseFloat(event.target.value),\n            };\n            break;\n          case FilterTypes.blur:\n            updatedLayers[index].filters = {\n              ...updatedLayers[index].filters,\n              [FilterTypes.blur]: parseInt(event.target.value, 10),\n            };\n            break;\n          case FilterTypes.hue:\n            updatedLayers[index].filters = {\n              ...updatedLayers[index].filters,\n              [FilterTypes.hue]: parseInt(event.target.value, 10),\n            };\n            break;\n          case FilterTypes.opacity:\n            updatedLayers[index].filters[FilterTypes.opacity] = parseFloat(\n              event.currentTarget.value\n            );\n            break;\n        }\n        setLayers(updatedLayers);\n      };\n    },\n    [layers, selectedLayer, setLayers]\n  );\n\n  return (\n    <FiltersWrapper>\n      <div>\n        <label>\n          sepia:\n          <input\n            type=\"checkbox\"\n            checked={currentLayer?.filters?.[FilterTypes.sepia] ?? false}\n            onChange={applyFilter(FilterTypes.sepia)}\n          />\n        </label>\n      </div>\n      <div>\n        <label>saturation:</label>\n        <br />\n        <input\n          type=\"range\"\n          min={0}\n          max={3}\n          step={0.01}\n          value={currentLayer?.filters?.[FilterTypes.saturation] ?? \"\"}\n          onChange={applyFilter(FilterTypes.saturation)}\n        />\n      </div>\n      <div>\n        <label>brushSize:</label>\n        <br />\n        <input\n          type=\"range\"\n          min={0}\n          max={100}\n          step={1}\n          value={brushSize}\n          onChange={(e) => setBrushSize(parseInt(e.target.value, 10))}\n        />\n      </div>\n      <div>\n        <label>rotation:</label>\n        <br />\n        <input\n          type=\"range\"\n          min={0}\n          max={360}\n          step={1}\n          value={currentLayer?.rotation ?? \"0\"}\n          onChange={(event) => {\n            setLayers((layers) => {\n              return layers.map((layer) => {\n                if (layer.id === selectedLayer?.id) {\n                  const r = parseInt(event.target.value, 10);\n                  layer.rotation = r;\n                  layer.pointGroups = layer.pointGroups.map((pointGroup) => {\n                    pointGroup.rotation = r;\n                    return pointGroup;\n                  });\n                }\n                return layer;\n              });\n            });\n          }}\n        />\n      </div>\n      <div>\n        <label>blur({currentLayer?.filters?.[FilterTypes.blur]}px):</label>\n        <br />\n        <input\n          type=\"range\"\n          min={0}\n          max={100}\n          step={1}\n          value={currentLayer?.filters?.[FilterTypes.blur] ?? \"\"}\n          onChange={applyFilter(FilterTypes.blur)}\n        />\n      </div>\n      <div>\n        <label>hue({currentLayer?.filters?.[FilterTypes.hue]}&deg;):</label>\n        <br />\n        <input\n          type=\"range\"\n          min={0}\n          max={360}\n          step={1}\n          value={currentLayer?.filters?.[FilterTypes.hue] ?? \"\"}\n          onChange={applyFilter(FilterTypes.hue)}\n        />\n      </div>\n      <div>\n        <label>opacity:</label>\n        <br />\n        <input\n          type=\"range\"\n          min={0}\n          max={1}\n          step={0.01}\n          value={currentLayer?.filters?.[FilterTypes.opacity] ?? \"0\"}\n          onChange={applyFilter(FilterTypes.opacity)}\n        />\n      </div>\n    </FiltersWrapper>\n  );\n}\n","import styled, { css } from \"styled-components\";\nimport vars from \"../../config/vars\";\n\nexport const LayersWrapper = styled.div`\n  position: relative;\n  overflow: auto;\n  -webkit-overflow-scrolling: touch;\n  max-height: 250px;\n  margin-top: 1em;\n`;\n\ntype LayerItemProps = {\n  selected: boolean;\n};\n\nexport const LayerItem = styled.div<LayerItemProps>`\n  cursor: pointer;\n  padding: 1em 0.5em;\n  border-bottom: 1px solid ${vars.colors.black100};\n  background-color: ${vars.colors.black200};\n\n  &:hover {\n    background-color: ${vars.colors.black400};\n  }\n\n  ${(props) => {\n    if (!props.selected) return \"\";\n    return css`\n      background-color: ${vars.colors.black400};\n    `;\n  }}\n\n  &:last-child {\n    border-bottom: none;\n  }\n\n  img,\n  div {\n    display: inline-block;\n    vertical-align: middle;\n  }\n\n  img {\n    align-self: center;\n    width: 1em;\n    margin-right: 0.5em;\n    flex-shrink: 0;\n  }\n\n  div {\n    overflow: hidden;\n    flex: 1 0;\n  }\n\n  label {\n    pointer-events: none;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: block;\n    width: 100%;\n  }\n\n  input {\n    display: block;\n    outline: none;\n  }\n`;\n","import React from \"react\";\nimport { LayerItem, LayersWrapper } from \"./styles\";\nimport { Layer, OrderType, PsContextType } from \"../../config/types\";\nimport { EYE_ICON } from \"../../config/images\";\nimport { sortLayers } from \"../../utils\";\nimport { PsContext } from \"../ps/context\";\n\nexport default function Layers() {\n  const {\n    layers,\n    setLayers,\n    selectedLayer,\n    setSelectedLayer,\n  } = React.useContext(PsContext) as PsContextType;\n  const wrapper = React.useRef<HTMLDivElement | null>(null);\n  const [renameLayer, setRenameLayer] = React.useState<Layer | null>(null);\n  const [layerName, setLayerName] = React.useState<string>(\"\");\n\n  const selectLayer = React.useCallback(\n    (layer) => {\n      return () => setSelectedLayer(layer);\n    },\n    [setSelectedLayer]\n  );\n\n  const toggleVisibility = React.useCallback(\n    (layer) => {\n      return () => {\n        const updatedLayers = [...layers];\n        const index = updatedLayers.findIndex((item) => item.id === layer.id);\n        if (index === -1) return;\n        updatedLayers[index].visible = !updatedLayers[index].visible;\n        setLayers(updatedLayers);\n      };\n    },\n    [layers, setLayers]\n  );\n\n  const onDoubleClick = React.useCallback((layer: Layer) => {\n    return () => {\n      setLayerName(layer.name);\n      setRenameLayer(layer);\n    };\n  }, []);\n\n  const onKeyDown = React.useCallback((event: React.KeyboardEvent) => {\n    event.stopPropagation();\n    if (event.key.toLowerCase() === \"escape\") {\n      setRenameLayer(null);\n    }\n  }, []);\n\n  // @todo fix event type\n  const onFocus = React.useCallback((event: any) => {\n    event.target.select();\n  }, []);\n\n  const onBlur = React.useCallback(() => {\n    setRenameLayer(null);\n  }, []);\n\n  const onChange = React.useCallback(\n    (event: React.FormEvent<HTMLInputElement>) => {\n      setLayerName(event.currentTarget.value);\n    },\n    []\n  );\n\n  const onSubmit = React.useCallback(\n    (event: React.FormEvent) => {\n      event.preventDefault();\n      if (renameLayer === null) return;\n      const updatedLayers = [...layers];\n      const index = updatedLayers.findIndex(\n        (item) => item.id === renameLayer.id\n      );\n      if (index === -1) return;\n      updatedLayers[index].name = layerName;\n      setLayers(updatedLayers);\n      setRenameLayer(null);\n    },\n    [layers, setLayers, renameLayer, layerName]\n  );\n\n  return (\n    <LayersWrapper ref={wrapper}>\n      {sortLayers(layers, OrderType.desc).map((layer) => {\n        return (\n          <LayerItem\n            key={layer.id}\n            title={layer.name}\n            selected={selectedLayer?.id === layer.id}\n            onClick={selectLayer(layer)}\n          >\n            <img\n              src={EYE_ICON}\n              alt=\"\"\n              title=\"Toggle layer visibility\"\n              onClick={toggleVisibility(layer)}\n              style={{ opacity: layer.visible ? 1 : 0 }}\n            />\n            <div onDoubleClick={onDoubleClick(layer)}>\n              {renameLayer?.id !== layer.id && <label>{layer.name}</label>}\n              {renameLayer?.id === layer.id && (\n                <form onSubmit={onSubmit}>\n                  <input\n                    autoFocus\n                    value={layerName}\n                    onChange={onChange}\n                    onFocus={onFocus}\n                    onBlur={onBlur}\n                    onKeyDown={onKeyDown}\n                  />\n                </form>\n              )}\n            </div>\n          </LayerItem>\n        );\n      })}\n    </LayersWrapper>\n  );\n}\n","import React from \"react\";\nimport { SidebarWrapper } from \"./styles\";\nimport { Flex, Spacer } from \"../../styles\";\nimport { PsContextType } from \"../../config/types\";\nimport { PsContext } from \"../ps/context\";\nimport Filters from \"../filters/filters\";\nimport Layers from \"../layers/layers\";\n\nexport default function Sidebar() {\n  const { download, reset, layers } = React.useContext(\n    PsContext\n  ) as PsContextType;\n\n  if (layers.length === 0) return null;\n\n  return (\n    <SidebarWrapper>\n      <Flex style={{ padding: \"1em\" }}>\n        <button onClick={download}>download</button>\n        <Spacer horizontal=\"0.5em\" />\n        <button onClick={reset}>reset</button>\n      </Flex>\n      <Filters />\n      <Layers />\n    </SidebarWrapper>\n  );\n}\n","import React from \"react\";\nimport { PsInner, PsWrapper } from \"./styles\";\nimport { Flex } from \"../../styles\";\nimport Toolbar from \"../toolbar/toolbar\";\nimport Canvas from \"../canvas/canvas\";\nimport Sidebar from \"../sidebar/sidebar\";\nimport PsContextProvider from \"./context\";\n\nexport default function Ps() {\n  return (\n    <PsContextProvider>\n      <PsWrapper>\n        <PsInner>\n          <Flex>\n            <Toolbar />\n            <Canvas />\n            <Sidebar />\n          </Flex>\n        </PsInner>\n      </PsWrapper>\n    </PsContextProvider>\n  );\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport Ps from \"./components/ps/ps\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <Ps />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}