{"version":3,"sources":["config/types.ts","config/vars.ts","config/consts.ts","components/ps/styles.ts","components/toolbar/styles.ts","config/images.ts","utils.ts","services/emitter.ts","components/ps/context.tsx","components/toolbar/toolbar.tsx","components/canvas/styles.ts","components/canvas/canvas.tsx","components/sidebar/styles.ts","components/layers/styles.ts","components/layers/layers.tsx","components/sidebar/sidebar.tsx","components/ps/ps.tsx","index.tsx"],"names":["Tool","ToolHotKey","OrderType","white","black","black400","black300","black200","black100","DEFAULTS","position","x","y","startX","startY","lastX","lastY","filters","blur","saturation","hue","sepia","pointGroups","pointGroupIndex","color","vars","brushSize","rotation","tool","move","opacity","scale","pressedKeys","layers","selectedLayer","PsWrapper","styled","div","PsInner","MAX_CANVAS_WIDTH","PsFlex","ToolbarWrapper","ToolButton","button","props","inactive","css","active","encode","svg","encodeURIComponent","TRANSPARENT_BACKGROUND","MOVE_ICON","ZOOM_ICON","BRUSH_ICON","COLOR_ICON","CROP_ICON","EYE_ICON","CROP_ICON_CURSOR","cursorWidth","clamp","value","min","max","Math","getPosition","event","element","getBoundingClientRect","left","top","width","height","abs","touches","pageX","pageY","getPoints","pointer","size","settings","minD","p","pointGroup","undefined","points","a","b","lastPoint","length","sqrt","pow","getCursor","brush","zoom","direction","includes","zoomOut","crop","uuid","replace","c","r","random","toString","createLayer","file","zIndex","allowedTypes","Promise","resolve","reject","type","src","URL","createObjectURL","img","Image","onload","canvas","document","createElement","ctx","getContext","drawImage","id","name","visible","image","toDataURL","ratio","revokeObjectURL","join","createTransform","layer","cx","cy","sortLayers","order","desc","sort","asc","events","Map","fn","has","set","get","filter","item","data","forEach","PsContext","React","createContext","PsContextProvider","children","useState","setPointGroups","setPointGroupIndex","down","setPointer","setSize","setRotation","setTool","setFilters","setColor","setBrushSize","setScale","setOpacity","setLayers","setSelectedLayer","setPressedKeys","useMemo","lineCap","useRef","reset","useCallback","download","current","toBlob","blob","href","click","setAttribute","base64","outerHTML","removeAttribute","useEffect","svgElement","addEventListener","onPointerDown","passive","window","onPointerMove","onPointerUp","removeEventListener","point","map","preventDefault","emitter","index","findIndex","getKey","key","toLowerCase","onKeyDown","onKeyUp","indexOf","splice","context","Provider","Toolbar","useContext","colorInput","toggleTool","currentTool","onClick","title","alt","ref","onChange","e","target","CanvasWrapper","CanvasHelper","Canvas","onDragOver","stopPropagation","onDrop","files","Array","from","dataTransfer","newLayers","i","push","console","error","concat","style","cursor","display","viewBox","xmlns","xmlnsXlink","maxWidth","maxHeight","stdDeviation","values","transform","onDragStart","stroke","fill","d","strokeWidth","strokeLinecap","strokeLinejoin","strokeMiterlimit","SidebarWrapper","LayersWrapper","LayerItem","selected","Layers","selectLayer","toggleVisibility","Sidebar","checked","step","parseFloat","parseInt","Ps","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.b9f27080.chunk.js","sourcesContent":["import React from \"react\";\n\nexport type Point = {\n  x: number;\n  y: number;\n};\n\nexport type PointGroup = {\n  color: string;\n  size: number;\n  points: Point[];\n};\n\nexport type Pointer = {\n  down: boolean;\n  x: number;\n  y: number;\n};\n\nexport type Settings = {\n  lineCap: \"round\";\n  p: number;\n};\n\nexport type Position = {\n  x: number;\n  y: number;\n  startX: number;\n  startY: number;\n  lastX: number;\n  lastY: number;\n};\n\nexport type Filters = {\n  blur: number;\n  saturation: number;\n  hue: number;\n  sepia: boolean;\n};\n\nexport type Size = {\n  width: number;\n  height: number;\n  ratio: number;\n};\n\nexport type GetPointsProps = {\n  pointGroups: PointGroup[];\n  pointGroupIndex: number;\n  pointer: Pointer;\n  color: string;\n  brushSize?: number;\n  size: {\n    width: number;\n    height: number;\n  };\n  settings: Settings;\n};\n\nexport enum Tool {\n  move,\n  brush,\n  zoom,\n  crop,\n}\n\nexport enum ToolHotKey {\n  move = \"v\",\n  brush = \"b\",\n  zoom = \"z\",\n  zoomOut = \"alt\",\n  crop = \"c\",\n}\n\nexport type PressedKeys = string[];\n\nexport type Layer = {\n  id: string;\n  name: string;\n  visible: boolean;\n  image: {\n    src: string;\n    width: number;\n    height: number;\n    ratio: number;\n  };\n  rotation: number;\n  position: Position;\n  filters: Filters;\n  opacity: number;\n  zIndex: number;\n};\n\nexport type PsContextType = {\n  layers: Layer[];\n  setLayers: React.Dispatch<React.SetStateAction<Layer[]>>;\n  selectedLayer: Layer | null;\n  setSelectedLayer: React.Dispatch<React.SetStateAction<Layer | null>>;\n  pointGroups: PointGroup[];\n  setPointGroups: React.Dispatch<React.SetStateAction<PointGroup[]>>;\n  pointGroupIndex: number;\n  setPointGroupIndex: React.Dispatch<React.SetStateAction<number>>;\n  pointer: Pointer;\n  setPointer: React.Dispatch<React.SetStateAction<Pointer>>;\n  size: Size;\n  setSize: React.Dispatch<React.SetStateAction<Size>>;\n  rotation: number;\n  setRotation: React.Dispatch<React.SetStateAction<number>>;\n  tool: Tool;\n  setTool: React.Dispatch<React.SetStateAction<Tool>>;\n  filters: Filters;\n  setFilters: React.Dispatch<React.SetStateAction<Filters>>;\n  color: string;\n  setColor: React.Dispatch<React.SetStateAction<string>>;\n  brushSize: number;\n  setBrushSize: React.Dispatch<React.SetStateAction<number>>;\n  scale: number;\n  setScale: React.Dispatch<React.SetStateAction<number>>;\n  opacity: number;\n  setOpacity: React.Dispatch<React.SetStateAction<number>>;\n  pressedKeys: PressedKeys;\n  setPressedKeys: React.Dispatch<React.SetStateAction<PressedKeys>>;\n  settings: Settings;\n  svg: React.MutableRefObject<SVGSVGElement | null>;\n  reset: React.MouseEventHandler;\n  download: React.MouseEventHandler;\n};\n\nexport enum OrderType {\n  asc,\n  desc,\n}\n","// eslint-disable-next-line import/no-anonymous-default-export\nexport default {\n  colors: {\n    white: \"#ffffff\",\n    black: \"#000000\",\n    black400: \"#444\",\n    black300: \"#333\",\n    black200: \"#222\",\n    black100: \"#1c1c1c\",\n  },\n};\n","import vars from \"./vars\";\nimport { Tool } from \"./types\";\n\nexport const DEFAULTS = {\n  position: {\n    x: 0,\n    y: 0,\n    startX: 0,\n    startY: 0,\n    lastX: 0,\n    lastY: 0,\n  },\n  filters: {\n    blur: 0,\n    saturation: 1,\n    hue: 0,\n    sepia: false,\n  },\n  pointGroups: [],\n  pointGroupIndex: -1,\n  color: vars.colors.black,\n  brushSize: 10,\n  rotation: 0,\n  tool: Tool.move,\n  opacity: 1,\n  scale: 1,\n  pressedKeys: [],\n  layers: [],\n  selectedLayer: null,\n};\n\nexport const MOBILE_WIDTH = 700;\n\nexport const MAX_CANVAS_WIDTH = 800;\n\nexport const MAX_SIDEBAR_WIDTH = 200;\n\nexport const ZOOM_DELTA = 0.01;\n","import styled from \"styled-components\";\nimport vars from \"../../config/vars\";\nimport {\n  MAX_CANVAS_WIDTH,\n  MAX_SIDEBAR_WIDTH,\n  MOBILE_WIDTH,\n} from \"../../config/consts\";\n\nexport const PsWrapper = styled.div`\n  width: 100%;\n  min-height: 100%;\n  background-color: ${vars.colors.black100};\n  color: ${vars.colors.white};\n  user-select: none;\n  padding: 1em;\n`;\n\nexport const PsInner = styled.div`\n  width: 100%;\n  max-width: ${MAX_CANVAS_WIDTH + MAX_SIDEBAR_WIDTH}px;\n  margin-left: auto;\n  margin-right: auto;\n`;\n\nexport const PsFlex = styled.div`\n  display: flex;\n  justify-content: center;\n  flex-wrap: wrap;\n\n  @media (max-width: ${MOBILE_WIDTH}px) {\n    flex-direction: column;\n    justify-content: flex-start;\n  }\n`;\n","import styled, { css } from \"styled-components\";\nimport vars from \"../../config/vars\";\n\nconst TOOL_BUTTON_PADDING = \"0.5em\";\n\nexport const ToolbarWrapper = styled.div`\n  width: 100%;\n  background-color: ${vars.colors.black300};\n  padding: 0.25em;\n  display: flex;\n`;\n\ntype ToolButtonProps = {\n  active?: boolean;\n  inactive?: boolean;\n};\n\nexport const ToolButton = styled.button<ToolButtonProps>`\n  border: none;\n  background-color: transparent;\n  cursor: pointer;\n  outline: none;\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: ${TOOL_BUTTON_PADDING};\n  margin-right: 0.25em;\n\n  &:last-child {\n    margin-right: 0;\n  }\n\n  &:hover {\n    background-color: ${vars.colors.black100};\n\n    ${(props) => {\n      if (!props.inactive) return;\n      return css`\n        background-color: transparent;\n      `;\n    }}\n  }\n\n  ${(props) => {\n    if (!props.active) return;\n    return css`\n      background-color: ${vars.colors.black100};\n    `;\n  }}\n\n  img {\n    width: 1.5em;\n    align-self: center;\n    flex-shrink: 0;\n  }\n\n  input {\n    position: absolute;\n    cursor: pointer;\n    opacity: 0;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    z-index: 1;\n  }\n`;\n","import vars from \"./vars\";\n\nfunction encode(svg: string): string {\n  return `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;\n}\n\nexport const TRANSPARENT_BACKGROUND = encode(\n  `<svg width=\"20\" height=\"20\" viewBox=\"0 0 40 40\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m0 0h20v20h-20z\" fill=\"#d7d7d7\"/><path d=\"m20 20h20v20h-20z\" fill=\"#d7d7d7\"/><g fill=\"${vars.colors.white}\"><path d=\"m20 0h20v20h-20z\"/><path d=\"m0 20h20v20h-20z\"/></g></svg>`\n);\n\nexport const MOVE_ICON = encode(\n  `<svg width=\"100\" height=\"100\" viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m2674 2900-23.08 19.23v-15.38h-23.07v23.07h15.38l-19.23 23.08-19.23-23.08h15.38v-23.07h-23.07v15.38l-23.08-19.23 23.08-19.23v15.38h23.07v-23.07h-15.38l19.23-23.08 19.23 23.08h-15.38v23.07h23.07v-15.38z\" fill=\"${vars.colors.white}\" fill-rule=\"evenodd\" transform=\"translate(-2574 -2850)\"/></svg>`\n);\n\nexport const ZOOM_ICON = encode(\n  `<svg width=\"100\" height=\"98.46\" viewBox=\"0 0 100 98.46\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m2210.36 2012.7-8.65 8.64-32.57-32.57a36.468 36.468 0 1 1 8.41-8.88zm-63.33-83.71a30.56 30.56 0 1 0 30.57 30.56 30.564 30.564 0 0 0 -30.57-30.56zm0 13.75a16.653 16.653 0 0 0 -9.16 2.75v-6.94a22.909 22.909 0 0 1 32.09 21h-6.12a16.809 16.809 0 0 0 -16.81-16.81z\" fill=\"${vars.colors.white}\" fill-rule=\"evenodd\" transform=\"translate(-2110.34 -1922.88)\"/></svg>`\n);\n\nexport const BRUSH_ICON = encode(\n  `<svg width=\"99.93\" height=\"102.85\" viewBox=\"0 0 99.93 102.85\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m2628.24 1289.83s-2.56-8.1-13.65-10.23c10.6-12.15 50.94-60.57 58-54.58 8.92 7.55-44.35 64.81-44.35 64.81zm-3.41 10.24s1.1 27.29-51.18 27.29c0 0 10.24-7.01 10.24-13.65 0-6.82 6.65-30.7 23.88-30.7 17.06 0 17.06 17.06 17.06 17.06z\" fill=\"${vars.colors.white}\" fill-rule=\"evenodd\" transform=\"translate(-2573.66 -1224.53)\"/></svg>`\n);\n\nexport const COLOR_ICON = encode(\n  `<svg width=\"100\" height=\"100\" viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m2674 2022h-70v-30h-30v-70h70v30h30zm-10-60h-20v30h-30v20h50z\" fill=\"${vars.colors.white}\" fill-rule=\"evenodd\" transform=\"translate(-2574 -1922)\"/></svg>`\n);\n\nexport const CROP_ICON = encode(\n  `<svg width=\"100\" height=\"89.188\" viewBox=\"0 0 100 89.188\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m1278.45 838.175h-12.17v-8.108h12.17a4.054 4.054 0 0 1 0 8.108zm-21.63 18.919a4.05 4.05 0 0 1 -4.05-4.054v-60.81h-31.08a4.055 4.055 0 1 1 0-8.109h39.19v68.919a4.058 4.058 0 0 1 -4.06 4.054zm-13.51-27.027a4.054 4.054 0 0 1 0 8.108h-39.19v-66.216a4.055 4.055 0 0 1 8.11 0v58.108zm-60.81-41.891a4.05 4.05 0 0 1 4.05-4.055h12.17v8.109h-12.17a4.051 4.051 0 0 1 -4.05-4.054z\" fill=\"${vars.colors.white}\" fill-rule=\"evenodd\" transform=\"translate(-1182.5 -767.906)\"/></svg>`\n);\n\nexport const EYE_ICON = encode(\n  `<svg width=\"99.3\" height=\"66.2\" viewBox=\"0 0 99.3 66.2\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"${vars.colors.white}\"><path d=\"m49.7 0c-32.7 0-49.7 33.1-49.7 33.1s18.5 33.1 49.7 33.1c33.1 0 49.7-33.1 49.7-33.1s-17.9-33.1-49.7-33.1zm0 53.8c-13.7 0-24.8-8.6-24.8-20.7 0-16.4 11.1-24.8 24.8-24.8s24.8 8.2 24.8 24.8c0 12.3-11.1 20.7-24.8 20.7z\"/><path d=\"m62.1 29c-4.6 0-8.3-3.7-8.3-8.3 0-1.4.4-2.7 1-3.8-1-.2-2-.3-3-.3-8 0-14.5 6.5-14.5 14.5s6.5 14.5 14.5 14.5 14.5-6.5 14.5-14.5c0-1-.1-2.1-.3-3-1.3.5-2.6.9-3.9.9z\"/></g></svg>`\n);\n\nconst cursorRatio = 89.188 / 100;\nconst cursorScale = 0.5;\nconst cursorWidth = 100 * cursorScale;\nconst cursorHeight = cursorWidth * cursorScale * cursorRatio;\nexport const CROP_ICON_CURSOR = encode(\n  `<svg width=\"${cursorWidth}\" height=\"${cursorHeight}\" viewBox=\"0 0 100 89.188\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m1278.45 838.175h-12.17v-8.108h12.17a4.054 4.054 0 0 1 0 8.108zm-21.63 18.919a4.05 4.05 0 0 1 -4.05-4.054v-60.81h-31.08a4.055 4.055 0 1 1 0-8.109h39.19v68.919a4.058 4.058 0 0 1 -4.06 4.054zm-13.51-27.027a4.054 4.054 0 0 1 0 8.108h-39.19v-66.216a4.055 4.055 0 0 1 8.11 0v58.108zm-60.81-41.891a4.05 4.05 0 0 1 4.05-4.055h12.17v8.109h-12.17a4.051 4.051 0 0 1 -4.05-4.054z\" fill=\"${vars.colors.white}\" fill-rule=\"evenodd\" transform=\"translate(-1182.5 -767.906)\"/></svg>`\n);\n","import {\n  GetPointsProps,\n  Layer,\n  OrderType,\n  Point,\n  PointGroup,\n  PressedKeys,\n  Size,\n  Tool,\n  ToolHotKey,\n} from \"./config/types\";\nimport { CROP_ICON_CURSOR } from \"./config/images\";\nimport { DEFAULTS } from \"./config/consts\";\n\nexport function clamp(value: number, min: number, max: number): number {\n  return Math.min(Math.max(value, min), max);\n}\n\nexport function dist(a: Point, b: Point): number {\n  return Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));\n}\n\nexport function getPosition(\n  event: TouchEvent | PointerEvent,\n  element: SVGSVGElement | null\n): Point {\n  if (element === null) return { x: 0, y: 0 };\n  let { left, top, width, height } = element.getBoundingClientRect();\n  left = Math.abs(left);\n  top = Math.abs(top);\n  let x;\n  let y;\n  if (\"touches\" in event) {\n    x = event.touches[0]?.pageX ?? 0;\n    y = event.touches[0]?.pageY ?? 0;\n  } else {\n    x = event.pageX;\n    y = event.pageY;\n  }\n  return {\n    x: clamp(x - left, 0, width) / width,\n    y: clamp(y - top, 0, height) / height,\n  };\n}\n\nexport function getPoints({\n  pointGroups,\n  pointGroupIndex,\n  pointer,\n  color,\n  brushSize = 10,\n  size,\n  settings,\n}: GetPointsProps): PointGroup[] {\n  const minD = brushSize / Math.min(size.width, size.height) / settings.p;\n  const pointGroup = pointGroups[pointGroupIndex];\n  if (pointGroup === undefined) {\n    pointGroups[pointGroupIndex] = {\n      color,\n      size: brushSize,\n      points: [{ x: pointer.x, y: pointer.y }],\n    };\n    return [...pointGroups];\n  }\n  const lastPoint = pointGroup.points[pointGroup.points.length - 1];\n  if (lastPoint !== undefined) {\n    const d = dist(lastPoint, pointer);\n    if (d < minD) return pointGroups;\n  }\n  pointGroups[pointGroupIndex].color = color;\n  pointGroups[pointGroupIndex].points = [\n    ...pointGroups[pointGroupIndex].points,\n    { x: pointer.x, y: pointer.y },\n  ];\n  return [...pointGroups];\n}\n\nexport function getCursor(tool: Tool, pressedKeys: PressedKeys = []): string {\n  switch (tool) {\n    case Tool.move:\n      return \"move\";\n    case Tool.brush:\n      return \"none\";\n    case Tool.zoom:\n      const direction = pressedKeys.includes(ToolHotKey.zoomOut) ? \"out\" : \"in\";\n      return `zoom-${direction}`;\n    case Tool.crop:\n      return `url(\"${CROP_ICON_CURSOR}\") 17 0, default`;\n    default:\n      return \"default\";\n  }\n}\n\nexport function uuid(): string {\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\n    // eslint-disable-next-line no-mixed-operators\n    const r = (Math.random() * 16) | 0,\n      v = c === \"x\" ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport function createLayer(file: File, zIndex = 0): Promise<Layer> {\n  const allowedTypes = [\"image/png\", \"image/jpg\", \"image/jpeg\"];\n  return new Promise((resolve, reject) => {\n    if (!allowedTypes.includes(file.type)) {\n      reject(`Invalid image file, must be one of: ${allowedTypes.join(\" \")}`);\n      return;\n    }\n    const src = URL.createObjectURL(file);\n    const img = new Image();\n    img.onload = () => {\n      const canvas = document.createElement(\"canvas\");\n      const ctx = canvas.getContext(\"2d\");\n      if (ctx === null) {\n        reject(\"Failed to load image\");\n        return;\n      }\n      canvas.width = img.width;\n      canvas.height = img.height;\n      // @todo scale down large images to improve performance\n      ctx.drawImage(img, 0, 0);\n      resolve({\n        id: uuid(),\n        name: file.name ?? `Layer ${zIndex + 1}`,\n        visible: true,\n        image: {\n          src: canvas.toDataURL(\"image/png\"),\n          width: img.width,\n          height: img.height,\n          ratio: img.width / img.height,\n        },\n        rotation: DEFAULTS.rotation,\n        position: DEFAULTS.position,\n        filters: DEFAULTS.filters,\n        opacity: DEFAULTS.opacity,\n        zIndex,\n      });\n      URL.revokeObjectURL(src);\n    };\n    img.src = src;\n  });\n}\n\nexport function createTransform(size: Size, layer: Layer): string {\n  const { rotation, position } = layer;\n  const cx = size.width / 2;\n  const cy = size.height / 2;\n  const s = 1;\n  return [\n    `translate(${position.x * size.width} ${position.y * size.height})`,\n    `rotate(${rotation}, ${size.width / 2}, ${size.height / 2})`,\n    `matrix(${s}, 0, 0, ${s}, ${cx - s * cx}, ${cy - s * cy})`,\n  ].join(\" \");\n}\n\nexport function sortLayers(\n  layers: Layer[],\n  order: OrderType = OrderType.desc\n): Layer[] {\n  return layers.sort((a, b) => {\n    if (order === OrderType.desc) return b.zIndex - a.zIndex;\n    if (order === OrderType.asc) return a.zIndex - b.zIndex;\n    return 0;\n  });\n}\n","import { uuid } from \"../utils\";\n\ntype Event = {\n  id: string;\n  name: string;\n  fn: Function;\n};\n\nconst events = new Map();\n\n// eslint-disable-next-line import/no-anonymous-default-export\nexport default {\n  subscribe(event: string, fn: Function) {\n    const id = uuid();\n    if (!events.has(event)) {\n      events.set(event, []);\n    }\n    events.set(event, [...events.get(event), { id, name: event, fn }]);\n    return () => {\n      if (!events.has(event)) return;\n      events.set(\n        event,\n        events.get(event).filter((item: Event) => item.id !== id)\n      );\n    };\n  },\n  unsubscribe(event: string) {\n    if (!events.has(event)) return;\n    events.delete(event);\n  },\n  emit(event: string, data?: any) {\n    if (!events.has(event)) return;\n    events.get(event).forEach((item: Event) => {\n      item.fn(data);\n    });\n  },\n};\n","import React from \"react\";\nimport {\n  Filters,\n  Pointer,\n  PointGroup,\n  PressedKeys,\n  PsContextType,\n  Settings,\n  Size,\n  Tool,\n  ToolHotKey,\n  Layer,\n} from \"../../config/types\";\nimport { DEFAULTS, ZOOM_DELTA } from \"../../config/consts\";\nimport { getPoints, getPosition } from \"../../utils\";\nimport emitter from \"../../services/emitter\";\n\ntype Props = {\n  children: any;\n};\n\nexport const PsContext = React.createContext({});\n\nexport default function PsContextProvider({ children }: Props) {\n  const [pointGroups, setPointGroups] = React.useState<PointGroup[]>(\n    DEFAULTS.pointGroups\n  );\n  const [pointGroupIndex, setPointGroupIndex] = React.useState<number>(\n    DEFAULTS.pointGroupIndex\n  );\n  const [pointer, setPointer] = React.useState<Pointer>({\n    down: false,\n    x: 0,\n    y: 0,\n  });\n  const [size, setSize] = React.useState<Size>({\n    width: 0,\n    height: 0,\n    ratio: 1,\n  });\n  const [rotation, setRotation] = React.useState<number>(DEFAULTS.rotation);\n  const [tool, setTool] = React.useState<Tool>(Tool.move);\n  const [filters, setFilters] = React.useState<Filters>(DEFAULTS.filters);\n  const [color, setColor] = React.useState<string>(DEFAULTS.color);\n  const [brushSize, setBrushSize] = React.useState<number>(DEFAULTS.brushSize);\n  const [scale, setScale] = React.useState<number>(DEFAULTS.scale);\n  const [opacity, setOpacity] = React.useState<number>(DEFAULTS.opacity);\n  const [layers, setLayers] = React.useState<Layer[]>(DEFAULTS.layers);\n  const [selectedLayer, setSelectedLayer] = React.useState<Layer | null>(\n    DEFAULTS.selectedLayer\n  );\n  const [pressedKeys, setPressedKeys] = React.useState<PressedKeys>(\n    DEFAULTS.pressedKeys\n  );\n  const settings = React.useMemo<Settings>(() => {\n    return {\n      lineCap: \"round\",\n      p: 3 * size.ratio, // precision\n    };\n  }, [size]);\n  const svg = React.useRef<SVGSVGElement | null>(null);\n\n  const reset = React.useCallback(() => {\n    setFilters(DEFAULTS.filters);\n    setPointGroups(DEFAULTS.pointGroups);\n    setPointGroupIndex(DEFAULTS.pointGroupIndex);\n    setColor(DEFAULTS.color);\n    setBrushSize(DEFAULTS.brushSize);\n    setRotation(DEFAULTS.rotation);\n    setTool(DEFAULTS.tool);\n    setOpacity(DEFAULTS.opacity);\n    setScale(DEFAULTS.scale);\n    setPressedKeys(DEFAULTS.pressedKeys);\n    setLayers(DEFAULTS.layers);\n    setSelectedLayer(DEFAULTS.selectedLayer);\n  }, []);\n\n  const download = React.useCallback(() => {\n    const svgElement: SVGSVGElement | null = svg.current;\n    if (svgElement === null) return;\n    const canvas = document.createElement(\"canvas\");\n    const ctx: CanvasRenderingContext2D | null = canvas.getContext(\"2d\");\n    if (ctx === null) return;\n    const img = new Image();\n    img.onload = () => {\n      canvas.width = img.width;\n      canvas.height = img.height;\n      ctx.drawImage(img, 0, 0, img.width, img.height);\n      canvas.toBlob((blob) => {\n        const a = document.createElement(\"a\");\n        a.href = URL.createObjectURL(blob);\n        a.download = \"image.png\";\n        a.click();\n      }, \"image/png\");\n    };\n    if (svg.current === null) return;\n    svg.current.setAttribute(\"width\", size.width.toString());\n    svg.current.setAttribute(\"height\", size.height.toString());\n    const base64 = encodeURIComponent(svg.current.outerHTML);\n    img.src = `data:image/svg+xml;utf8,${base64}`;\n    svg.current.removeAttribute(\"width\");\n    svg.current.removeAttribute(\"height\");\n  }, [size, svg]);\n\n  React.useEffect(() => {\n    const svgElement: SVGSVGElement | null = svg.current;\n\n    if (svgElement === null) return;\n\n    function onPointerDown(event: TouchEvent | PointerEvent) {\n      const point = getPosition(event, svgElement);\n      if (tool === Tool.brush) {\n        setPointGroupIndex((pointGroupIndex) => pointGroupIndex + 1);\n        setPointGroups((pointGroups) => [\n          ...pointGroups,\n          { color, size: brushSize, points: [point, point] },\n        ]);\n      }\n      if (selectedLayer !== null) {\n        setLayers((layers) => {\n          return layers.map((layer) => {\n            if (layer.id === selectedLayer.id) {\n              layer.position = {\n                ...layer.position,\n                startX: point.x,\n                startY: point.y,\n              };\n            }\n            return layer;\n          });\n        });\n      }\n      setPointer((pointer) => ({ ...pointer, ...point, down: true }));\n    }\n\n    function onPointerMove(event: TouchEvent | PointerEvent) {\n      event.preventDefault();\n      const point = getPosition(event, svgElement);\n      setPointer((pointer) => ({ ...pointer, ...point }));\n    }\n\n    function onPointerUp() {\n      if (selectedLayer !== null) {\n        setLayers((layers) => {\n          return layers.map((layer) => {\n            if (layer.id === selectedLayer.id) {\n              layer.position = {\n                ...layer.position,\n                lastX: layer.position.x,\n                lastY: layer.position.y,\n              };\n            }\n            return layer;\n          });\n        });\n      }\n      setPointer((pointer) => ({ ...pointer, down: false }));\n    }\n\n    svgElement.addEventListener(\"pointerdown\", onPointerDown, {\n      passive: true,\n    });\n    window.addEventListener(\"pointermove\", onPointerMove, { passive: false });\n    window.addEventListener(\"pointerup\", onPointerUp, { passive: false });\n    svgElement.addEventListener(\"touchstart\", onPointerDown, {\n      passive: false,\n    });\n    window.addEventListener(\"touchmove\", onPointerMove, { passive: false });\n    window.addEventListener(\"touchend\", onPointerUp, { passive: false });\n    return () => {\n      svgElement.removeEventListener(\"pointerdown\", onPointerDown);\n      window.removeEventListener(\"pointermove\", onPointerMove);\n      window.removeEventListener(\"pointerup\", onPointerUp);\n      svgElement.removeEventListener(\"touchstart\", onPointerDown);\n      window.removeEventListener(\"touchmove\", onPointerMove);\n      window.removeEventListener(\"touchend\", onPointerUp);\n    };\n  }, [\n    svg,\n    tool,\n    size,\n    color,\n    brushSize,\n    setPointGroupIndex,\n    setPointGroups,\n    setPointer,\n    selectedLayer,\n    setLayers,\n    pointer,\n  ]);\n\n  React.useEffect(() => {\n    if (!pointer.down || tool !== Tool.brush) return;\n    setPointGroups((pointGroups) =>\n      getPoints({\n        pointGroups,\n        pointGroupIndex,\n        pointer,\n        color,\n        size,\n        settings,\n      })\n    );\n  }, [tool, pointer, pointGroupIndex, color, size, settings, setPointGroups]);\n\n  React.useEffect(() => {\n    if (!pointer.down || tool !== Tool.move || selectedLayer === null) return;\n    setLayers((layers) => {\n      return layers.map((layer) => {\n        if (layer.id === selectedLayer.id) {\n          layer.position = {\n            ...layer.position,\n            x: pointer.x - layer.position.startX + layer.position.lastX,\n            y: pointer.y - layer.position.startY + layer.position.lastY,\n          };\n        }\n        return layer;\n      });\n    });\n  }, [pointer, tool, selectedLayer]);\n\n  React.useEffect(() => {\n    if (pressedKeys.includes(ToolHotKey.move)) {\n      setTool(Tool.move);\n    }\n    if (pressedKeys.includes(ToolHotKey.brush)) {\n      setTool(Tool.brush);\n    }\n    if (pressedKeys.includes(ToolHotKey.zoom)) {\n      setTool(Tool.zoom);\n    }\n    if (pressedKeys.includes(ToolHotKey.crop)) {\n      setTool(Tool.crop);\n    }\n  }, [pressedKeys]);\n\n  React.useEffect(() => {\n    if (pointer.down && tool === Tool.zoom) {\n      const direction = pressedKeys.includes(ToolHotKey.zoomOut) ? -1 : 1;\n      setScale((scale) => scale + ZOOM_DELTA * direction);\n    }\n  }, [pressedKeys, tool, pointer.down]);\n\n  React.useEffect(() => {\n    return emitter.subscribe(\"layer.visibility\", (layer: Layer) => {\n      const index = layers.findIndex((item) => item.id === layer.id);\n      if (index === -1) return [];\n      layers[index].visible = !layers[index].visible;\n      setLayers([...layers]);\n    });\n  }, [layers]);\n\n  React.useEffect(() => {\n    function getKey(event: KeyboardEvent): string {\n      return event.key.toLowerCase();\n    }\n\n    function onKeyDown(event: KeyboardEvent) {\n      const key = getKey(event);\n      setPressedKeys((pressedKeys) => {\n        if (pressedKeys.includes(key)) return pressedKeys;\n        return [...pressedKeys, key];\n      });\n    }\n\n    function onKeyUp(event: KeyboardEvent) {\n      const key = getKey(event);\n      setPressedKeys((pressedKeys) => {\n        const index = pressedKeys.indexOf(key);\n        if (index === -1) return pressedKeys;\n        pressedKeys.splice(index, 1);\n        return [...pressedKeys];\n      });\n    }\n\n    window.addEventListener(\"keydown\", onKeyDown);\n    window.addEventListener(\"keyup\", onKeyUp);\n    return () => {\n      window.removeEventListener(\"keydown\", onKeyDown);\n      window.removeEventListener(\"keyup\", onKeyUp);\n    };\n  }, []);\n\n  const context: PsContextType = {\n    layers,\n    setLayers,\n    selectedLayer,\n    setSelectedLayer,\n    pointGroups,\n    setPointGroups,\n    pointGroupIndex,\n    setPointGroupIndex,\n    pointer,\n    setPointer,\n    size,\n    setSize,\n    rotation,\n    setRotation,\n    tool,\n    setTool,\n    filters,\n    setFilters,\n    color,\n    setColor,\n    brushSize,\n    setBrushSize,\n    scale,\n    setScale,\n    opacity,\n    setOpacity,\n    pressedKeys,\n    setPressedKeys,\n    settings,\n    svg,\n    reset,\n    download,\n  };\n\n  return <PsContext.Provider value={context}>{children}</PsContext.Provider>;\n}\n","import React from \"react\";\nimport { ToolbarWrapper, ToolButton } from \"./styles\";\nimport {\n  BRUSH_ICON,\n  COLOR_ICON,\n  CROP_ICON,\n  MOVE_ICON,\n  ZOOM_ICON,\n} from \"../../config/images\";\nimport { PsContextType, Tool, ToolHotKey } from \"../../config/types\";\nimport { PsContext } from \"../ps/context\";\nimport { DEFAULTS } from \"../../config/consts\";\n\nexport default function Toolbar() {\n  const { tool, setTool, setColor } = React.useContext(\n    PsContext\n  ) as PsContextType;\n  const colorInput = React.useRef<HTMLInputElement | null>(null);\n\n  const toggleTool = React.useCallback(\n    (tool: Tool) => {\n      return () => {\n        setTool((currentTool) => {\n          if (currentTool === tool) return DEFAULTS.tool;\n          return tool;\n        });\n      };\n    },\n    [setTool]\n  );\n\n  return (\n    <ToolbarWrapper>\n      <ToolButton\n        onClick={toggleTool(Tool.move)}\n        active={tool === Tool.move}\n        title={`Move (${ToolHotKey.move})`}\n      >\n        <img src={MOVE_ICON} alt=\"\" />\n      </ToolButton>\n      <ToolButton\n        onClick={toggleTool(Tool.zoom)}\n        active={tool === Tool.zoom}\n        title={`Zoom (${ToolHotKey.zoom})`}\n      >\n        <img src={ZOOM_ICON} alt=\"\" />\n      </ToolButton>\n      <ToolButton\n        onClick={toggleTool(Tool.brush)}\n        active={tool === Tool.brush}\n        title={`Brush (${ToolHotKey.brush})`}\n      >\n        <img src={BRUSH_ICON} alt=\"\" />\n      </ToolButton>\n      <ToolButton inactive title=\"Color\">\n        <img src={COLOR_ICON} alt=\"\" />\n        <input\n          ref={colorInput}\n          type=\"color\"\n          onChange={(e) => setColor(e.target.value)}\n        />\n      </ToolButton>\n      <ToolButton\n        onClick={toggleTool(Tool.crop)}\n        active={tool === Tool.crop}\n        title={`Crop (${ToolHotKey.crop})`}\n      >\n        <img src={CROP_ICON} alt=\"\" />\n      </ToolButton>\n    </ToolbarWrapper>\n  );\n}\n","import styled from \"styled-components\";\nimport { MAX_CANVAS_WIDTH, MOBILE_WIDTH } from \"../../config/consts\";\nimport { TRANSPARENT_BACKGROUND } from \"../../config/images\";\nimport vars from \"../../config/vars\";\n\nexport const CanvasWrapper = styled.div`\n  flex: 1 0;\n  width: 100%;\n  max-width: ${MAX_CANVAS_WIDTH}px;\n  background-color: ${vars.colors.black400};\n\n  @media (max-width: ${MOBILE_WIDTH}px) {\n    flex: 0 1;\n  }\n\n  svg {\n    margin: auto;\n    display: block;\n    background-repeat: repeat;\n    background-image: url(${TRANSPARENT_BACKGROUND});\n  }\n`;\n\nexport const CanvasHelper = styled.div`\n  pointer-events: none;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n`;\n","import React from \"react\";\nimport { CanvasWrapper, CanvasHelper } from \"./styles\";\nimport { Layer, PsContextType, Tool } from \"../../config/types\";\nimport { PsContext } from \"../ps/context\";\nimport {\n  getCursor,\n  createLayer,\n  createTransform,\n  sortLayers,\n} from \"../../utils\";\n\nexport default function Canvas() {\n  const {\n    size,\n    scale,\n    setSize,\n    setSelectedLayer,\n    filters,\n    layers,\n    setLayers,\n    pointGroups,\n    settings,\n    tool,\n    pointer,\n    brushSize,\n    color,\n    svg,\n    pressedKeys,\n  } = React.useContext(PsContext) as PsContextType;\n\n  const onDragOver = React.useCallback((event: React.DragEvent<any>) => {\n    event.stopPropagation();\n    event.preventDefault();\n  }, []);\n\n  const onDrop = React.useCallback(\n    async (event: React.DragEvent<any>) => {\n      event.stopPropagation();\n      event.preventDefault();\n      const files = Array.from(event.dataTransfer.files);\n      const newLayers: Layer[] = [];\n      for (let i = 0; i < files.length; i++) {\n        try {\n          newLayers.push(await createLayer(files[i], layers.length + i));\n        } catch (err) {\n          // @todo show error to user\n          console.error(err);\n        }\n      }\n      setLayers(layers.concat(newLayers));\n    },\n    [layers, setLayers]\n  );\n\n  React.useEffect(() => {\n    if (layers.length > 0 && size.width + size.height === 0) {\n      setSize({\n        width: layers[0].image.width,\n        height: layers[0].image.height,\n        ratio: layers[0].image.ratio,\n      });\n      setSelectedLayer(layers[0]);\n    }\n  }, [layers, size, setSize, setSelectedLayer]);\n\n  return (\n    <CanvasWrapper\n      style={{ cursor: getCursor(tool, pressedKeys) }}\n      onDragOver={onDragOver}\n      onDrop={onDrop}\n    >\n      <CanvasHelper style={{ display: layers.length > 0 ? \"none\" : undefined }}>\n        Drop images here to get started!\n      </CanvasHelper>\n      <svg\n        ref={svg}\n        viewBox={`0 0 ${size.width} ${size.height}`}\n        xmlns=\"http://www.w3.org/2000/svg\"\n        xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n        style={{\n          maxWidth: `${size.width}px`,\n          maxHeight: `${size.height}px`,\n          display: layers.length === 0 ? \"none\" : undefined,\n        }}\n      >\n        <filter id=\"filters\">\n          {/* blur */}\n          <feGaussianBlur stdDeviation={filters.blur} />\n          {/* hue */}\n          <feColorMatrix type=\"hueRotate\" values={filters.hue.toString()} />\n          {/* saturation */}\n          <feColorMatrix\n            type=\"saturate\"\n            values={filters.saturation.toString()}\n          />\n          {/* sepia */}\n          {filters.sepia && (\n            <feColorMatrix\n              type=\"matrix\"\n              values=\"0.39 0.769 0.189 0 0 0.349 0.686 0.168 0 0 0.272 0.534 0.131 0 0 0 0 0 1 0\"\n            />\n          )}\n        </filter>\n\n        <g filter=\"url(#filters)\" style={{ transform: `scale(${scale})` }}>\n          {sortLayers(layers).map((layer, index) => {\n            if (!layer.visible) return null;\n            return (\n              <image\n                onDragStart={(event) => event.preventDefault()}\n                key={index}\n                href={layer.image.src}\n                transform={createTransform(size, layer)}\n                opacity={layer.opacity}\n              />\n            );\n          })}\n        </g>\n\n        {pointGroups.map((pointGroup, index) => {\n          return (\n            <path\n              key={index}\n              stroke={pointGroup.color}\n              fill=\"none\"\n              d={`M${pointGroup.points\n                .map((p) => [p.x * size.width, p.y * size.height].join(\",\"))\n                .join(\",\")}`}\n              strokeWidth={pointGroup.size}\n              strokeLinecap={settings.lineCap}\n              strokeLinejoin=\"round\"\n            />\n          );\n        })}\n        {tool === Tool.brush && (\n          <circle\n            cx={(pointer.x * size.width).toString()}\n            cy={(pointer.y * size.height).toString()}\n            r={brushSize / 2}\n            fill={color}\n            strokeMiterlimit=\"10\"\n          />\n        )}\n      </svg>\n    </CanvasWrapper>\n  );\n}\n","import styled from \"styled-components\";\nimport vars from \"../../config/vars\";\nimport { MAX_SIDEBAR_WIDTH, MOBILE_WIDTH } from \"../../config/consts\";\n\nexport const SidebarWrapper = styled.div`\n  align-self: flex-start;\n  width: 100%;\n  max-width: ${MAX_SIDEBAR_WIDTH}px;\n  background-color: ${vars.colors.black300};\n\n  @media (max-width: ${MOBILE_WIDTH}px) {\n    display: flex;\n    flex-wrap: wrap;\n    max-width: 100%;\n  }\n`;\n","import styled, { css } from \"styled-components\";\nimport vars from \"../../config/vars\";\n\nexport const LayersWrapper = styled.div`\n  overflow: auto;\n  -webkit-overflow-scrolling: touch;\n  max-height: 250px;\n  margin-top: 1em;\n`;\n\ntype LayerItemProps = {\n  selected: boolean;\n};\n\nexport const LayerItem = styled.div<LayerItemProps>`\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n  padding: 1em 0.5em;\n  border-bottom: 1px solid ${vars.colors.black100};\n  background-color: ${vars.colors.black200};\n\n  &:hover {\n    background-color: ${vars.colors.black400};\n  }\n\n  ${(props) => {\n    if (!props.selected) return \"\";\n    return css`\n      background-color: ${vars.colors.black400};\n    `;\n  }}\n\n  &:last-child {\n    border-bottom: none;\n  }\n\n  img {\n    display: block;\n    align-self: center;\n    width: 1em;\n    margin-right: 0.5em;\n    flex-shrink: 0;\n  }\n\n  div {\n    pointer-events: none;\n    overflow: hidden;\n    flex: 1 0;\n  }\n\n  label {\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: block;\n    width: 100%;\n  }\n`;\n","import React from \"react\";\nimport { LayerItem, LayersWrapper } from \"./styles\";\nimport { OrderType, PsContextType } from \"../../config/types\";\nimport { EYE_ICON } from \"../../config/images\";\nimport { sortLayers } from \"../../utils\";\nimport { PsContext } from \"../ps/context\";\nimport emitter from \"../../services/emitter\";\n\nexport default function Layers() {\n  const { layers, selectedLayer, setSelectedLayer } = React.useContext(\n    PsContext\n  ) as PsContextType;\n\n  const selectLayer = React.useCallback(\n    (layer) => {\n      return () => {\n        setSelectedLayer(layer);\n      };\n    },\n    [setSelectedLayer]\n  );\n\n  const toggleVisibility = React.useCallback((layer) => {\n    return () => {\n      emitter.emit(\"layer.visibility\", layer);\n    };\n  }, []);\n\n  return (\n    <LayersWrapper>\n      {sortLayers(layers, OrderType.asc).map((layer) => {\n        return (\n          <LayerItem\n            key={layer.id}\n            title={layer.name}\n            selected={selectedLayer?.id === layer.id}\n            onClick={selectLayer(layer)}\n          >\n            <img\n              src={EYE_ICON}\n              alt=\"\"\n              title=\"Toggle layer visibility\"\n              onClick={toggleVisibility(layer)}\n              style={{ opacity: layer.visible ? 1 : 0 }}\n            />\n            <div>\n              <label>{layer.name}</label>\n            </div>\n          </LayerItem>\n        );\n      })}\n    </LayersWrapper>\n  );\n}\n","import React from \"react\";\nimport { SidebarWrapper } from \"./styles\";\nimport { PsContextType } from \"../../config/types\";\nimport { PsContext } from \"../ps/context\";\nimport Layers from \"../layers/layers\";\n\nexport default function Sidebar() {\n  const {\n    filters,\n    setFilters,\n    brushSize,\n    setBrushSize,\n    rotation,\n    setRotation,\n    opacity,\n    setOpacity,\n    download,\n    reset,\n  } = React.useContext(PsContext) as PsContextType;\n\n  return (\n    <SidebarWrapper>\n      <div>\n        <label>\n          sepia:\n          <input\n            type=\"checkbox\"\n            checked={filters.sepia}\n            onChange={(e) =>\n              setFilters((filters) => ({\n                ...filters,\n                sepia: e.target.checked,\n              }))\n            }\n          />\n        </label>\n      </div>\n      <div>\n        <label>saturation({filters.saturation}):</label>\n        <br />\n        <input\n          type=\"range\"\n          min={0}\n          max={3}\n          step={0.01}\n          value={filters.saturation}\n          onChange={(e) =>\n            setFilters((filters) => ({\n              ...filters,\n              saturation: parseFloat(e.target.value),\n            }))\n          }\n        />\n      </div>\n      <div>\n        <label>brushSize({brushSize}px):</label>\n        <br />\n        <input\n          type=\"range\"\n          min={0}\n          max={100}\n          step={1}\n          value={brushSize}\n          onChange={(e) => setBrushSize(parseInt(e.target.value, 10))}\n        />\n      </div>\n      <div>\n        <label>rotation({rotation}&deg;):</label>\n        <br />\n        <input\n          type=\"range\"\n          min={0}\n          max={360}\n          step={1}\n          value={rotation}\n          onChange={(e) => setRotation(parseInt(e.target.value, 10))}\n        />\n      </div>\n      <div>\n        <label>blur({filters.blur}px):</label>\n        <br />\n        <input\n          type=\"range\"\n          min={0}\n          max={100}\n          step={1}\n          value={filters.blur}\n          onChange={(e) =>\n            setFilters((filters) => ({\n              ...filters,\n              blur: parseInt(e.target.value, 10),\n            }))\n          }\n        />\n      </div>\n      <div>\n        <label>hue({filters.hue}&deg;):</label>\n        <br />\n        <input\n          type=\"range\"\n          min={0}\n          max={360}\n          step={1}\n          value={filters.hue}\n          onChange={(e) =>\n            setFilters((filters) => ({\n              ...filters,\n              hue: parseInt(e.target.value, 10),\n            }))\n          }\n        />\n      </div>\n      <div>\n        <label>opacity({opacity}):</label>\n        <br />\n        <input\n          type=\"range\"\n          min={0}\n          max={1}\n          step={0.01}\n          value={opacity}\n          onChange={(e) => setOpacity(parseFloat(e.target.value))}\n        />\n      </div>\n      <div>\n        <button onClick={download}>download</button>\n      </div>\n      <div>\n        <button onClick={reset}>reset</button>\n      </div>\n      <Layers />\n    </SidebarWrapper>\n  );\n}\n","import React from \"react\";\nimport { PsFlex, PsInner, PsWrapper } from \"./styles\";\nimport Toolbar from \"../toolbar/toolbar\";\nimport Canvas from \"../canvas/canvas\";\nimport Sidebar from \"../sidebar/sidebar\";\nimport PsContextProvider from \"./context\";\n\nexport default function Ps() {\n  return (\n    <PsContextProvider>\n      <PsWrapper>\n        <PsInner>\n          <Toolbar />\n          <PsFlex>\n            <Canvas />\n            <Sidebar />\n          </PsFlex>\n        </PsInner>\n      </PsWrapper>\n    </PsContextProvider>\n  );\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport Ps from \"./components/ps/ps\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <Ps />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}